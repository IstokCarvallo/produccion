$PBExportHeader$w_info_guia_despacho.srw
forward
global type w_info_guia_despacho from w_para_informes
end type
type st_1 from statictext within w_info_guia_despacho
end type
type st_2 from statictext within w_info_guia_despacho
end type
type dw_2 from datawindow within w_info_guia_despacho
end type
type st_6 from statictext within w_info_guia_despacho
end type
type dw_1 from datawindow within w_info_guia_despacho
end type
type em_nroguia from editmask within w_info_guia_despacho
end type
type gb_3 from groupbox within w_info_guia_despacho
end type
type cbx_1 from checkbox within w_info_guia_despacho
end type
type cbx_2 from checkbox within w_info_guia_despacho
end type
type cbx_3 from checkbox within w_info_guia_despacho
end type
type cbx_4 from checkbox within w_info_guia_despacho
end type
type st_3 from statictext within w_info_guia_despacho
end type
type st_5 from statictext within w_info_guia_despacho
end type
type st_7 from statictext within w_info_guia_despacho
end type
type st_8 from statictext within w_info_guia_despacho
end type
type em_recibidor from editmask within w_info_guia_despacho
end type
type em_rut from editmask within w_info_guia_despacho
end type
type em_direccion from editmask within w_info_guia_despacho
end type
type cbx_5 from checkbox within w_info_guia_despacho
end type
type st_9 from statictext within w_info_guia_despacho
end type
type em_observa from editmask within w_info_guia_despacho
end type
type dw_guia from datawindow within w_info_guia_despacho
end type
type cbx_6 from checkbox within w_info_guia_despacho
end type
type cbx_7 from checkbox within w_info_guia_despacho
end type
type cbx_8 from checkbox within w_info_guia_despacho
end type
type st_13 from statictext within w_info_guia_despacho
end type
type em_nomdespachador from editmask within w_info_guia_despacho
end type
type st_10 from statictext within w_info_guia_despacho
end type
type em_tipomv from editmask within w_info_guia_despacho
end type
type em_puerto from editmask within w_info_guia_despacho
end type
type em_destino from editmask within w_info_guia_despacho
end type
type st_11 from statictext within w_info_guia_despacho
end type
type st_12 from statictext within w_info_guia_despacho
end type
type st_14 from statictext within w_info_guia_despacho
end type
type em_nominspector from editmask within w_info_guia_despacho
end type
type gb_frio from groupbox within w_info_guia_despacho
end type
type cbx_frio from checkbox within w_info_guia_despacho
end type
type gb_4 from groupbox within w_info_guia_despacho
end type
type st_4 from statictext within w_info_guia_despacho
end type
type cbx_id from checkbox within w_info_guia_despacho
end type
type em_glosaespecial from editmask within w_info_guia_despacho
end type
type st_15 from statictext within w_info_guia_despacho
end type
type cbx_sdp from checkbox within w_info_guia_despacho
end type
type mle_condicion from multilineedit within w_info_guia_despacho
end type
type st_22 from statictext within w_info_guia_despacho
end type
type st_16 from statictext within w_info_guia_despacho
end type
type cbx_archivo from checkbox within w_info_guia_despacho
end type
type cbx_9 from checkbox within w_info_guia_despacho
end type
type st_17 from statictext within w_info_guia_despacho
end type
type em_numsellos from editmask within w_info_guia_despacho
end type
type st_18 from statictext within w_info_guia_despacho
end type
type em_ubisellos from editmask within w_info_guia_despacho
end type
type dw_3 from datawindow within w_info_guia_despacho
end type
type em_cansellos from editmask within w_info_guia_despacho
end type
type cbx_valores from checkbox within w_info_guia_despacho
end type
type st_19 from statictext within w_info_guia_despacho
end type
type em_ciudad from editmask within w_info_guia_despacho
end type
type cbx_csg from checkbox within w_info_guia_despacho
end type
type dw_4 from datawindow within w_info_guia_despacho
end type
type dw_5 from datawindow within w_info_guia_despacho
end type
type dw_6 from datawindow within w_info_guia_despacho
end type
type dw_7 from datawindow within w_info_guia_despacho
end type
type dw_8 from datawindow within w_info_guia_despacho
end type
type dw_tipopallet from datawindow within w_info_guia_despacho
end type
type dw_etiqueta from datawindow within w_info_guia_despacho
end type
type st_20 from statictext within w_info_guia_despacho
end type
type em_exportador from editmask within w_info_guia_despacho
end type
type em_rutexpo from editmask within w_info_guia_despacho
end type
end forward

global type w_info_guia_despacho from w_para_informes
integer x = 14
integer y = 32
integer width = 2857
integer height = 2568
string title = "Módulo de Despacho"
boolean minbox = false
boolean maxbox = false
boolean resizable = false
windowtype windowtype = response!
string icon = "F:\Desarrollo\Producción\FrutaProcesada\Producc.ico"
st_1 st_1
st_2 st_2
dw_2 dw_2
st_6 st_6
dw_1 dw_1
em_nroguia em_nroguia
gb_3 gb_3
cbx_1 cbx_1
cbx_2 cbx_2
cbx_3 cbx_3
cbx_4 cbx_4
st_3 st_3
st_5 st_5
st_7 st_7
st_8 st_8
em_recibidor em_recibidor
em_rut em_rut
em_direccion em_direccion
cbx_5 cbx_5
st_9 st_9
em_observa em_observa
dw_guia dw_guia
cbx_6 cbx_6
cbx_7 cbx_7
cbx_8 cbx_8
st_13 st_13
em_nomdespachador em_nomdespachador
st_10 st_10
em_tipomv em_tipomv
em_puerto em_puerto
em_destino em_destino
st_11 st_11
st_12 st_12
st_14 st_14
em_nominspector em_nominspector
gb_frio gb_frio
cbx_frio cbx_frio
gb_4 gb_4
st_4 st_4
cbx_id cbx_id
em_glosaespecial em_glosaespecial
st_15 st_15
cbx_sdp cbx_sdp
mle_condicion mle_condicion
st_22 st_22
st_16 st_16
cbx_archivo cbx_archivo
cbx_9 cbx_9
st_17 st_17
em_numsellos em_numsellos
st_18 st_18
em_ubisellos em_ubisellos
dw_3 dw_3
em_cansellos em_cansellos
cbx_valores cbx_valores
st_19 st_19
em_ciudad em_ciudad
cbx_csg cbx_csg
dw_4 dw_4
dw_5 dw_5
dw_6 dw_6
dw_7 dw_7
dw_8 dw_8
dw_tipopallet dw_tipopallet
dw_etiqueta dw_etiqueta
st_20 st_20
em_exportador em_exportador
em_rutexpo em_rutexpo
end type
global w_info_guia_despacho w_info_guia_despacho

type prototypes
FUNCTION long ShellExecuteW(uint ihwnd,string lpszOp,string lpszFile,string lpszParams, string lpszDir,int wShowCmd ) LIBRARY "Shell32.dll"
end prototypes

type variables
str_busqueda	istr_busq
str_mant 		istr_mant

Integer	ii_tipo, ii_condicion, ii_tipoemb, ii_especie, ii_var, ii_prod, ii_cal, ii_cli, ii_pakrot, ii_controlstembex
String		is_report, is_Recibidor, is_Direccion, is_Rut, is_archivo, is_asunto, is_tipopla, is_ciudad, is_embarque,&
			is_correosaampuerto, is_parteemb, is_nombrexpo, is_rutexpo
Long		il_despacho, al_planilla

DataWindowChild	idwc_tipopro, idwc_cliente, idwc_planta

uo_Plantadesp	iuo_Plantas

w_informes_guia		vinf1
end variables

forward prototypes
public function boolean existeguia (long al_guia)
public subroutine enviamail ()
public subroutine generaarchivo ()
public function boolean valida_datos ()
public function boolean obtiene_condicion (integer ai_cliente, integer ai_planta, long al_pallet)
public function boolean existearchivo (integer li_cliente, integer li_planta, long ll_guia, long al_planillas, string as_tipoplanilla, string as_instructivo)
public subroutine enviamailarchivo ()
public function boolean existeoperacion (string operacion)
public function boolean wf_actualiza_db (boolean borrando)
public subroutine generaarchivostembex ()
protected function integer despacho (integer li_cliente, integer li_planta, long ll_guia)
public function boolean validadespacho (integer li_cliente, integer li_planta, long ll_guia)
public function boolean existe_exportador (integer ai_exportador)
public function boolean busca_nombre (integer ai_cliente)
end prototypes

public function boolean existeguia (long al_guia);Integer	li_codexp, li_planta, li_Tipova, li_tipoembq, li_embc_codigo, li_tecnic, li_cansel, li_exportador
Date		ld_fecha
String	ls_Embarque, ls_puerto, ls_destino, ls_contraparte, ls_numsel, ls_ubisel
LOng		ll_fila, ll_fila1, ll_contpal, ll_cont
li_codexp		=	Integer(istr_mant.argumento[1])
li_planta		=	Integer(istr_mant.argumento[2])

is_Recibidor	= ''
is_Direccion	= ''
is_Rut			= ''

IF al_guia <> 0 OR li_planta = 0 THEN

	SELECT defe_tiposa,defe_numero,defe_especi
		INTO	:li_tipoembq,:il_despacho,:ii_especie
		FROM	dbo.DESPAFRIGOEN 
		WHERE	plde_codigo =	:li_planta
		AND	clie_codigo	=	:li_codexp
		AND	defe_guides	=	:al_guia;
		
		ii_tipoemb = li_tipoembq
				
	IF sqlca.SQLCode = -1 THEN
		F_ErrorBaseDatos(sqlca,"Lectura de la Tabla DESPAFRIGOEN")
		em_nroguia.SetFocus()
		RETURN False
	ELSEIF sqlca.SQLCode = 100 THEN
		MessageBox("Atención", "No existe Número Guia Despacho Indicado.~r~rIngrese otro Número.", &
						Exclamation!, Ok!)
		pb_acepta.Enabled	= False
		em_nroguia.SetFocus()
		RETURN False
	ELSEIF li_tipoembq = 7 OR li_tipoembq = 8 OR li_tipoembq = 9 THEN		
		
		SELECT embq_codigo, defe_tecnic, defe_plasag, defe_nturno, defe_fecdes
		INTO	:ls_Embarque, :li_tecnic, :al_planilla, :is_tipopla, :ld_fecha	
		FROM	dbo.DESPAFRIGOEN 
		WHERE	plde_codigo =	:li_planta
		AND	clie_codigo	=	:li_codexp
		AND	defe_guides	=	:al_guia;
		
		is_embarque = ls_Embarque
		
		IF ls_Embarque <> '' THEN
			IF ExisteOperacion(ls_Embarque) THEN
			END IF	
		END IF	
								
		SELECT RTrim(tecn_nombre)+' '+RTrim(tecn_apepat)+' '+RTrim(tecn_apemat)
		INTO  :ls_contraparte
		FROM dbo.cargostecnicos
		WHERE tecn_codigo = :li_tecnic
		AND plde_codigo = :li_planta;

		SELECT embq_tipova, embc_codigo, pu.puer_nombre, de.dest_nombre, em.expo_codigo
		INTO	:li_Tipova, :li_embc_codigo, :ls_puerto, :ls_destino, :li_exportador
		FROM	dbo.EMBARQUEPROD as em, dbo.destinos as de, dbo.puertos as pu
		WHERE	em.clie_codigo	=	:li_codexp
		AND	em.embq_codigo	=	:ls_Embarque
		AND	em.puer_codigo =	pu.puer_codigo
		AND	em.dest_codigo = 	de.dest_codigo;
		
		existe_exportador(li_exportador)
		
		SELECT  isnull(defe_cansel,0), isnull(defe_numsel,''), isnull(defe_ubisel,'')
		INTO	:li_cansel,  :ls_numsel,  :ls_ubisel
		FROM	dbo.DESPAFRIGOEN 
		WHERE	plde_codigo =	:li_planta
		AND	clie_codigo	=	:li_codexp
		AND	defe_plasag	=	:al_planilla
		AND   defe_nturno =  :is_tipopla
		AND   defe_fecdes =  :ld_fecha
		AND   defe_numero =  :il_despacho;	
		
		ll_fila = dw_3.Retrieve(li_planta,al_planilla)
		
		IF ll_fila > 0 THEN
			FOR ll_fila1 = 1 TO dw_3.RowCount()
				ls_numsel = ls_numsel+''+dw_3.Object.sell_numero[ll_fila1]+'-'
				ls_ubisel = ls_ubisel+''+dw_3.Object.sell_nombre[ll_fila1]+'-'
			NEXT
		END IF	
		
		em_cansellos.Text = String(ll_fila)
		
		ls_numsel = Mid(ls_numsel, 1,len(ls_numsel) -1 )
		ls_ubisel = Mid(ls_ubisel, 1,len(ls_ubisel) -1 )
		
		em_numsellos.Text			=	ls_numsel
		em_ubisellos.Text			=	ls_ubisel
								
		IF sqlca.SQLCode = -1 THEN
			//F_ErrorBaseDatos(sqlca,"Lectura de la Tabla DESPAFRIGOEN")
			MessageBox("Atención", "Problema en Selección de Detalle en Encabezado del Despacho.", &
							Exclamation!, Ok!)	
		END IF
			
		IF sqlca.SQLCode = -1 THEN
			F_ErrorBaseDatos(sqlca,"Lectura de la Tabla EMBARQUEPROD")
			em_nroguia.SetFocus()
			RETURN False
//		ELSEIF sqlca.SQLCode = 100 THEN
//				MessageBox("Atención", "No existe Embarque.~r~r", &
//							Exclamation!, Ok!)
//				pb_acepta.Enabled	= False
//				em_nroguia.SetFocus()
//				RETURN False
		ELSE					
			SELECT embc_nombre, embc_direcc, embc_nrorut, embc_ciudad
			INTO	:is_Recibidor, :is_Direccion, :is_Rut, :is_ciudad
			FROM	dbo.EMBARCADORES 
			WHERE	embc_codigo	=	:li_embc_codigo;	
			
			IF sqlca.SQLCode = -1 THEN
				F_ErrorBaseDatos(sqlca,"Lectura de la Tabla EMBARCADORES")
				em_nroguia.SetFocus()
				RETURN False
			ELSEIF sqlca.SQLCode = 100 THEN
				MessageBox("Atención", "No existe Embarcadores.~r~r", &
							Exclamation!, Ok!)
				pb_acepta.Enabled	= False
				em_nroguia.SetFocus()
				RETURN False			
			ELSE
				
				SELECT count(*)
				INTO	:ll_contpal
				FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
				WHERE	enc.plde_codigo =	:li_planta
				AND	enc.clie_codigo =	:li_codexp
				AND	enc.defe_guides =	:al_guia
				AND	enc.clie_codigo = det.clie_codigo
				AND	enc.plde_codigo = det.plde_codigo
				AND	enc.defe_numero = det.defe_numero;	
				
				IF sqlca.SQLCode = -1 THEN
					F_ErrorBaseDatos(sqlca,"Lectura de la Tabla Despachos")
					em_nroguia.SetFocus()
					RETURN False
				END IF
				
				IF ll_contpal >= 4 THEN
					SELECT count(*)
					INTO	:ll_cont
					FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
					WHERE	enc.plde_codigo =	:li_planta
					AND	enc.clie_codigo =	:li_codexp
					AND	enc.defe_guides =	:al_guia
					AND	enc.clie_codigo = det.clie_codigo
					AND	enc.plde_codigo = det.plde_codigo
					AND	enc.defe_numero = det.defe_numero
					AND 	isnull(det.defe_tempe1,0) <> 0;	
							
					IF sqlca.SQLCode = -1 THEN
						F_ErrorBaseDatos(sqlca,"Lectura de la Tabla Despachos")
						em_nroguia.SetFocus()
						RETURN False
					ELSEIF ll_cont < 2 THEN
						MessageBox("Atención", "Debe Registrar la Temperatura de al Menos 2 Pallet de esta Guía.~r~r", &
									Exclamation!, Ok!)
						pb_acepta.Enabled	= False
						em_nroguia.SetFocus()
						RETURN False	
					END IF	
				END IF
				
				istr_mant.argumento[25]	=	String(li_Tipova)
				em_recibidor.Text			=	is_Recibidor
				em_rut.Text					=	is_Rut
				em_direccion.Text			=	is_Direccion
				em_nomdespachador.Text	=  ls_contraparte
				em_ciudad.Text				=	is_ciudad
				pb_acepta.Enabled			= 	True
				IF  ii_tipo = 1 OR ii_tipo = 3 THEN
					em_recibidor.Enabled	=	True
					em_rut.Enabled			=	True
					em_direccion.Enabled	=	True
					em_puerto.Text 		=	ls_puerto
					em_destino.Text		=	ls_destino
				END IF
				RETURN True
			END IF
		END IF
				
	ELSEIF li_tipoembq = 21 OR li_tipoembq = 16 OR li_tipoembq = 31 THEN
		SELECT embq_codigo,clpr_rut, defe_plasag, defe_nturno, defe_fecdes
		INTO	:ls_embarque,:is_rut,:al_planilla, :is_tipopla, :ld_fecha	
		FROM	dbo.DESPAFRIGOEN 
		WHERE	plde_codigo =	:li_planta
		AND	clie_codigo	=	:li_codexp
		AND	defe_guides	=	:al_guia;
		
		is_embarque  = ls_embarque
		
		SELECT clpr_nombre,clpr_direcc
		INTO  :is_Recibidor,:is_Direccion
		FROM dbo.clienprove
		WHERE clpr_rut = :is_rut;
		
		SELECT embq_tipova, embc_codigo, pu.puer_nombre, de.dest_nombre
		INTO	:li_Tipova, :li_embc_codigo, :ls_puerto, :ls_destino
		FROM	dbo.EMBARQUEPROD as em, dbo.destinos as de, dbo.puertos as pu
		WHERE	em.clie_codigo	=	:li_codexp
		AND	em.embq_codigo	=	:ls_Embarque
		AND	em.puer_codigo =	pu.puer_codigo
		AND	em.dest_codigo = 	de.dest_codigo;
		
		SELECT  isnull(defe_cansel,0), isnull(defe_numsel,''), isnull(defe_ubisel,'')
		INTO	:li_cansel,  :ls_numsel,  :ls_ubisel
		FROM	dbo.DESPAFRIGOEN 
		WHERE	plde_codigo =	:li_planta
		AND	clie_codigo	=	:li_codexp
		AND	defe_plasag	=	:al_planilla
		AND   defe_nturno =  :is_tipopla
		AND   defe_fecdes =  :ld_fecha
		AND   defe_numero =  :il_despacho;	
		
		ll_fila = dw_3.Retrieve(li_planta,al_planilla)
		
		IF ll_fila > 0 THEN
			FOR ll_fila1 = 1 TO dw_3.RowCount()
				ls_numsel = Trim(ls_numsel)+''+Trim(dw_3.Object.sell_numero[ll_fila1])+'-'
				ls_ubisel = Trim(ls_ubisel)+''+Trim(dw_3.Object.sell_nombre[ll_fila1])+'-'
			NEXT
		END IF
		
		SELECT count(*)
		INTO	:ll_contpal
		FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
		WHERE	enc.plde_codigo =	:li_planta
		AND	enc.clie_codigo =	:li_codexp
		AND	enc.defe_guides =	:al_guia
		AND	enc.clie_codigo = det.clie_codigo
		AND	enc.plde_codigo = det.plde_codigo
		AND	enc.defe_numero = det.defe_numero;	
		
		IF sqlca.SQLCode = -1 THEN
			F_ErrorBaseDatos(sqlca,"Lectura de la Tabla Despachos")
			em_nroguia.SetFocus()
			RETURN False
		END IF
		
		IF ll_contpal >= 4 THEN
		
			SELECT count(*)
			INTO	:ll_cont
			FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
			WHERE	enc.plde_codigo =	:li_planta
			AND	enc.clie_codigo =	:li_codexp
			AND	enc.defe_guides =	:al_guia
			AND	enc.clie_codigo = det.clie_codigo
			AND	enc.plde_codigo = det.plde_codigo
			AND	enc.defe_numero = det.defe_numero
			AND 	isnull(det.defe_tempe1,0) <> 0;	
					
			IF sqlca.SQLCode = -1 THEN
				F_ErrorBaseDatos(sqlca,"Lectura de la Tabla Despachos")
				em_nroguia.SetFocus()
				RETURN False
			ELSEIF ll_cont < 2 THEN
				MessageBox("Atención", "Debe Registrar la Temperatura de al Menos 2 Pallet de esta Guía.~r~r", &
							Exclamation!, Ok!)
				pb_acepta.Enabled	= False
				em_nroguia.SetFocus()
				RETURN False	
			END IF	
		END IF
		em_cansellos.Text = String(ll_fila)
		
		ls_numsel = Mid(Trim(ls_numsel), 1,len(Trim(ls_numsel)) -1 )
		ls_ubisel = Mid(Trim(ls_ubisel), 1,len(Trim(ls_ubisel)) -1 )
		
		em_numsellos.Text			=	ls_numsel
		em_ubisellos.Text				=	ls_ubisel
		
		istr_mant.argumento[25]	=	String(li_Tipova)
		em_recibidor.Text			=	is_Recibidor
		em_rut.Text					=	is_rut
		em_direccion.Text			=	is_Direccion
		em_puerto.Text 			=	ls_puerto
		em_destino.Text			=	ls_destino
			
		em_recibidor.Enabled		=	True
		em_rut.Enabled				=	True				
		em_direccion.Enabled		=	True

	ELSEIF li_tipoembq = 11 THEN
		
		SELECT count(*)
		INTO	:ll_contpal
		FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
		WHERE	enc.plde_codigo =	:li_planta
		AND	enc.clie_codigo =	:li_codexp
		AND	enc.defe_guides =	:al_guia
		AND	enc.clie_codigo = det.clie_codigo
		AND	enc.plde_codigo = det.plde_codigo
		AND	enc.defe_numero = det.defe_numero;	
						
		IF sqlca.SQLCode = -1 THEN
			F_ErrorBaseDatos(sqlca,"Lectura de la Tabla Despachos")
			em_nroguia.SetFocus()
			RETURN False
		ELSEIF  ll_contpal >= 4 THEN
			
			SELECT count(*)
			INTO	:ll_cont
			FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
			WHERE	enc.plde_codigo =	:li_planta
			AND	enc.clie_codigo =	:li_codexp
			AND	enc.defe_guides =	:al_guia
			AND	enc.clie_codigo = det.clie_codigo
			AND	enc.plde_codigo = det.plde_codigo
			AND	enc.defe_numero = det.defe_numero
			AND 	isnull(det.defe_tempe1,0) <> 0;	
			
			IF ll_cont < 2 THEN
				MessageBox("Atención", "Debe Registrar la Temperatura de al Menos 2 Pallet de esta Guía.~r~r", &
							Exclamation!, Ok!)
				pb_acepta.Enabled	= False
				em_nroguia.SetFocus()
				RETURN False	
			END IF	
		END IF
		
		em_recibidor.Enabled		=	True
		em_rut.Enabled				=	True				
		em_direccion.Enabled		=	True
		istr_mant.argumento[25]	=	'1'
		pb_acepta.Enabled	= True
		RETURN True
	ELSE	
		
		SELECT count(*)
		INTO	:ll_contpal
		FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
		WHERE	enc.plde_codigo =	:li_planta
		AND	enc.clie_codigo =	:li_codexp
		AND	enc.defe_guides =	:al_guia
		AND	enc.clie_codigo = det.clie_codigo
		AND	enc.plde_codigo = det.plde_codigo
		AND	enc.defe_numero = det.defe_numero;	
		
		IF sqlca.SQLCode = -1 THEN
			F_ErrorBaseDatos(sqlca,"Lectura de la Tabla Despachos")
			em_nroguia.SetFocus()
			RETURN False
		END IF
		
		IF ll_contpal >= 4 THEN
		
			SELECT count(*)
			INTO	:ll_cont
			FROM	dbo.despafrigode as det,dbo.DESPAFRIGOEN as enc
			WHERE	enc.plde_codigo =	:li_planta
			AND	enc.clie_codigo =	:li_codexp
			AND	enc.defe_guides =	:al_guia
			AND	enc.clie_codigo = det.clie_codigo
			AND	enc.plde_codigo = det.plde_codigo
			AND	enc.defe_numero = det.defe_numero
			AND 	isnull(det.defe_tempe1,0) <> 0;	
					
			IF sqlca.SQLCode = -1 THEN
				F_ErrorBaseDatos(sqlca,"Lectura de la Tabla Despachos")
				em_nroguia.SetFocus()
				RETURN False
			ELSEIF ll_cont < 2 THEN
				MessageBox("Atención", "Debe Registrar la Temperatura de al Menos 2 Pallet de esta Guía.~r~r", &
							Exclamation!, Ok!)
				pb_acepta.Enabled	= False
				em_nroguia.SetFocus()
				RETURN False	
			END IF	
		END IF
		istr_mant.argumento[25]	=	'1'
		pb_acepta.Enabled	= True
		RETURN True
	END IF
ELSE
	MessageBox("Atención", "Faltan parámetros de búsqueda.~r~rIngreselos todos.", &
					Exclamation!, Ok!)
	RETURN False
END IF
end function

public subroutine enviamail ();String		ls_Nombre, ls_NomReporte, ls_Archivo, ls_DirectorioAct 
Long			ll_Fila, ll_consignatario, ll_Archivo
Boolean		lb_Existe
Integer		li_imprimio
str_parms	lstr_parms

SetPointer(HourGlass!)

//RegistryGet( "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders", "Personal", RegString!, ls_DirectorioAct)

ls_NomReporte									=	is_archivo
lstr_parms.string_arg[1]					=	String(1)
lstr_parms.string_arg[2]					=	'Guia Despacho Nº '+is_asunto
lstr_parms.string_arg[3]					=	String(1)

ll_Archivo = 1

lstr_parms.string_arg[ll_Archivo+3]		=	is_archivo

//FOR ll_Archivo = 1 TO 8
////	lstr_parms.string_arg[ll_Archivo+4]	=	ls_DirectorioAct + '\' + dw_archivos.Object.Nombre[ll_archivo]
//NEXT

OpenWithParm(w_correo_archivo_saam, lstr_parms)

lb_Existe	=	FileExists(lstr_parms.string_arg[ll_Archivo + 3])
	
IF lb_Existe THEN
	FileDelete(lstr_parms.string_arg[ll_Archivo + 3])
END IF

SetPointer(Arrow!)
end subroutine

public subroutine generaarchivo ();Long			ll_fila, ll_filas, ll_filadet, ll_guia, ll_numero, ll_cont, ll_planilla, ll_filcont
String		ls_Cliente, ls_Planta, ls_Patente, ls_Archivo, ls_Registro, ls_embarque,&
				ls_termog, ls_guia, ls_Instructivo
double		ll_termog
Integer		li_copallet, li_cliente, li_planta, li_Tipova
Datetime    ldt_hora

ldt_hora			=	Datetime(Date(Today()),Time(Today())	)

dw_6.reset()
dw_7.reset()
dw_4.reset()
dw_5.reset()

li_planta = dw_1.Object.plde_codigo[1]

dw_7.SetTransObject(Sqlca)
dw_6.SetTransObject(Sqlca)

// Para actualizar el estado=1 Cerrado, una vez generado el archivo
dw_4.SetTransObject(SQLCA)
dw_5.SetTransObject(SQLCA)
dw_guia.SetTransObject(SQLCA)

ls_Cliente		=	String(Integer(istr_mant.Argumento[1]), '000')
ls_Planta		=	String(Integer(istr_mant.Argumento[2]), '0000')
ls_guia 			=  em_nroguia.Text
ll_guia 			=  Long(em_nroguia.Text)
ls_Instructivo	=	is_embarque
ls_embarque		=	is_embarque
ll_planilla		=	al_planilla

ls_Archivo	=  "STEMBEX" +ls_Instructivo+"-"+ string(ll_planilla) + "." + Mid(ls_Planta, 2, 3) + ls_guia
is_archivo	=	ls_Archivo

ll_filcont		=  dw_5.Retrieve(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),&
										ll_planilla,ii_var,ii_cal,ii_prod,ll_guia, 0, '-1',ls_Instructivo)
IF ll_filcont > 0 THEN
	IF valida_datos() THEN
		Return
	END IF	
END IF	

ll_filas			=  dw_6.Retrieve(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),&
										ll_planilla,ii_var,ii_cal,ii_prod,ll_guia, 0, '-1',ls_Instructivo)
									  
li_cliente = Integer(istr_mant.argumento[1])

IF ll_filas = -1 THEN
	F_ErrorBaseDatos(sqlca,"Lectura de la Tabla EMBARQUEPROD")
ELSEIF ll_filas = 0 THEN
	MessageBox("Atención", "No hay información con Operación Indicada.~r~rIngrese otra Operación.", &
					Exclamation!, Ok!)

ELSE
	
	dw_6.SetSort('paen_numero')
     dw_6.Sort()

	FOR ll_fila = 1 TO ll_filas
		ls_Patente	=	String(dw_6.Object.defe_patent[ll_fila])
		
		IF IsNull(ls_Patente) THEN ls_Patente = ''
		
		ls_Registro	=	dw_6.Object.embq_codigo[ll_fila]
		ls_Registro	+=	String(dw_6.Object.defe_guides[ll_fila], '00000000')
		ls_Registro	+=	String(dw_6.Object.reci_codigo[ll_fila], '00000')
		ls_Registro	+=	String(dw_6.Object.plde_codigo[ll_fila], '0000')
		ls_Registro	+=	ls_Patente + Fill(' ',6 - Len(ls_Patente))
		ls_Registro	+=	String(dw_6.Object.espe_codigo[ll_fila], '00')
				
		Obtiene_condicion(dw_6.Object.clie_codigo[ll_fila],dw_6.Object.plde_codigo[ll_fila],dw_6.Object.paen_numero[ll_fila])
			
		IF ii_condicion = 1 THEN
			ls_Registro	+=	'F'
		ELSEIF dw_6.Object.paen_inspec[ll_fila] = 0 AND ii_condicion <> 1 AND ii_condicion <> 2  THEN
			ls_Registro	+=	'N'
		ELSEIF dw_6.Object.paen_inspec[ll_fila] = 1 THEN
			ls_Registro += 'I'
		ELSEIF ii_condicion = 2 THEN
			ls_Registro	+=	'U'
		END IF		
			
//		IF dw_6.Object.cond_codigo[ll_fila] = 1 THEN
//			ls_Registro	+=	'F'
//		ELSEIF dw_6.Object.paen_inspec[ll_fila] = 1 OR dw_6.Object.cond_codigo[ll_fila] = 2 THEN
//			ls_Registro += 'I'
//		ELSE
//			ls_Registro	+=	'N'
//		END IF
		
		ls_Registro	+=	ls_Cliente
		ls_Registro	+=	String(dw_6.Object.paen_numero[ll_fila], '0000000')
		ls_Registro	+=	String(dw_6.Object.etiq_codigo[ll_fila], '000')
		ls_Registro	+=	String(dw_6.Object.paen_fecemb[ll_fila], 'ddmmyy')
		ls_Registro	+=	String(dw_6.Object.prod_codigo[ll_fila], '00000')
		ls_Registro	+=	String(dw_6.Object.emba_codigo[ll_fila], '@@@@@@@@@@')
		ls_Registro	+=	String(dw_6.Object.vari_codigo[ll_fila], '0000')
		ls_Registro	+=	String(dw_6.Object.pafr_calibr[ll_fila], '@@@')
		ls_Registro	+=	String(dw_6.Object.pafr_ccajas[ll_fila], '0000000')
		ls_Registro	+=	String(dw_6.Object.cate_codigo[ll_fila], '000')
		
		IF dw_6.Object.tica_codigo[ll_fila] = 1 THEN
			ls_Registro	+=	'P'
		ELSEIF dw_6.Object.tica_codigo[ll_fila] = 2 THEN
			ls_Registro	+=	'C'
		ELSE
			ls_Registro	+=	'F'
		END IF
		
		IF dw_6.Object.embq_ptoori[ll_fila] = 901 THEN
			ls_Registro	+=	'06'
		ELSEIF dw_6.Object.embq_ptoori[ll_fila] = 902 THEN
			ls_Registro	+=	'01'
		ELSEIF dw_6.Object.embq_ptoori[ll_fila] = 903 THEN
			ls_Registro	+=	'02'
		ELSEIF dw_6.Object.embq_ptoori[ll_fila] = 904 THEN
			ls_Registro	+=	'03'
		ELSEIF (dw_6.Object.embq_ptoori[ll_fila] = 905 OR dw_6.Object.embq_ptoori[ll_fila] = 900 OR dw_6.Object.embq_ptoori[ll_fila] = 930 OR dw_6.Object.embq_ptoori[ll_fila] = 900) THEN
			ls_Registro	+=	'04'
		ELSEIF dw_6.Object.embq_ptoori[ll_fila] = 906 THEN
			ls_Registro	+=	'05'
		ELSE
			ls_Registro	+=	'04'
		END IF
		ls_Registro +=String(dw_6.Object.packing[ll_fila], '0000')

		IF IsNull(dw_6.Object.defe_termog[ll_fila]) THEN
			ll_termog = 0
			ls_termog = '0'
		ELSE
			ls_termog = String(dw_6.Object.defe_termog[ll_fila])
		END IF
	   ls_Registro +=String(ls_termog, Fill("@", 15))
		
		IF IsNull(dw_6.Object.copa_codigo[ll_fila]) THEN
			li_copallet	= 	0
		ELSE
			li_copallet =	dw_6.Object.copa_codigo[ll_fila]
		END IF
	   ls_Registro +=String(li_copallet, Fill("0", 3))
		
		ll_filadet	=	dw_7.InsertRow(0)
		dw_7.Object.registro[ll_filadet]	=	ls_Registro

		IF existearchivo(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),dw_6.Object.defe_guides[ll_fila],&
			al_planilla,String(-1),ls_Instructivo) THEN
			Return
		END IF
		
//		IF validadespacho(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),dw_6.Object.defe_guides[ll_fila],&
//			al_planilla,'-1',ls_Instructivo) THEN
//			Return
//		END IF
	NEXT
	
	IF dw_7.SaveAs(gs_disco+":\GeneradosSAAM\" + ls_Archivo, Text!, False) = -1 THEN
		MessageBox("Atención","No se pudo generar el archivo " + ls_Archivo)
	ELSE
		
		enviamailarchivo()
		
		MessageBox("Atención", "Archivo " + ls_Archivo + " Generado. Avise a Computación", &
							Exclamation!, Ok!)
		
		ll_filas		=  dw_4.Retrieve(Integer(istr_mant.argumento[1]), &
									  Integer(istr_mant.argumento[2]),al_planilla,ll_guia,'-1',ls_Instructivo)
													  
		IF ll_filas = -1 THEN
			F_ErrorBaseDatos(sqlca,"Lectura de la Tabla DESPAFRIGOEN")
		ELSEIF ll_filas = 0 THEN
			MessageBox("Atención", "No hay información ", &
							Exclamation!, Ok!)

		ELSE		
			FOR ll_fila	= 1 TO ll_filas
				dw_4.SetItem(ll_fila,'defe_estado',1)
				ll_numero  = dw_4.Object.defe_numero[ll_fila]
				li_cliente = dw_4.Object.clie_codigo[ll_fila]
				li_planta  = dw_4.Object.plde_codigo[ll_fila]
				
		   NEXT
			wf_actualiza_db(False)
		END IF
									  
	END IF

END IF

MESSAGEBOX("ATENCION","ARCHIVO STEMBEX ENVIADO A OFICINA CENTRAL")
end subroutine

public function boolean valida_datos ();Long ll_fila, ll_cont, ll_pallet
String	ls_mensaje
Integer	li_cliente, li_planta

li_cliente 	= Integer(istr_mant.argumento[1])
li_planta	= Integer(istr_mant.argumento[2])

ls_mensaje = ''

FOR ll_fila = 1 TO dw_5.RowCount()
	
	ll_pallet = dw_5.Object.paen_numero[ll_fila]
	
	SELECT Count(*)
	INTO :ll_cont
	FROM dbo.palletfruta
	WHERE paen_numero = :ll_pallet
	AND clie_codigo = :li_cliente
	AND plde_codigo = :li_planta
	AND (isnull(PAFR_CUART1,0) = 0
	OR isnull(PAFR_CUART4,0) = 0
	OR isnull(PAFR_HUERT1,0) = 0
	OR isnull(PAFR_HUERT4,0) = 0);
	
	IF ll_cont > 0 THEN
		ls_mensaje = ls_mensaje + String(ll_Pallet)+','
	END IF	
	
//	SELECT Count()
//	INTO :ll_cont
//	FROM dbo.palletfruta
//	WHERE paen_numero = :ll_pallet
//	AND (isnull(PAFR_CUART4,0) = 0;
//	
//	IF ll_cont > 0 THEN
//		ls_mensaje = ls_mensaje + String(ll_Pallet)+','
//	END IF	
//	
//	SELECT Count()
//	INTO :ll_cont
//	FROM dbo.palletfruta
//	WHERE paen_numero = :ll_pallet
//	AND isnull(PAFR_HUERT1,0) = 0;
//	
//	IF ll_cont > 0 THEN
//		ls_mensaje = ls_mensaje + String(ll_Pallet)+','
//	END IF	
//	
//	SELECT Count()
//	INTO :ll_cont
//	FROM dbo.palletfruta
//	WHERE paen_numero = :ll_pallet
//	AND isnull(PAFR_HUERT4,0) = 0;
//	
//	IF ll_cont > 0 THEN
//		ls_mensaje = ls_mensaje + String(ll_Pallet)+','
//	END IF	
NEXT	

IF ls_mensaje <> '' THEN
	MessageBox("Atención", "Pallet "+String(ls_mensaje)+" con Predio o Cuartel Nulo.~r~rArregle por Movimientos -> Mantención -> Mantención Predio Cuartel Detalle Pallet.", &
						Exclamation!, Ok!)
	Return True
END IF



Return False

	
end function

public function boolean obtiene_condicion (integer ai_cliente, integer ai_planta, long al_pallet);Long li_Existe
Date ld_fecha

	ii_condicion = 0
	
  SELECT max(fumi_fecfum)  
    INTO :ld_fecha
    FROM dbo.fumigadet as det,dbo.fumigaenc as enc 
   WHERE det.clie_codigo = :ai_cliente AND  
         det.plde_codigo = :ai_planta  AND  
         det.paen_numero = :al_pallet AND
			det.clie_codigo = enc.clie_codigo AND
			det.plde_codigo = enc.plde_codigo AND
			det.cond_codigo = enc.cond_codigo AND
			det.fumi_numero = enc.fumi_numero
	GROUP BY det.cond_codigo;
	
	
	SELECT det.cond_codigo  
    INTO :ii_condicion 
    FROM dbo.fumigadet as det,dbo.fumigaenc as enc 
   WHERE det.clie_codigo = :ai_cliente AND  
         det.plde_codigo = :ai_planta  AND  
         det.paen_numero = :al_pallet AND
			det.clie_codigo = enc.clie_codigo AND
			det.plde_codigo = enc.plde_codigo AND
			det.cond_codigo = enc.cond_codigo AND
			det.fumi_numero = enc.fumi_numero AND
			enc.fumi_fecfum = :ld_fecha;
	

	IF sqlca.SQLCode = -1 THEN
		F_ErrorBaseDatos(sqlca,"Lectura de la Tabla fumigadet")
		//em_despacho.SetFocus()
		RETURN True
	ELSEIF sqlca.SQLCode = 100 THEN
//		MessageBox("Atención", "No existe Guía Despacho Indicada.~r~rIngrese otro Número.", &
//						Exclamation!, Ok!)
//		pb_grabar.Enabled	= False
//		em_despacho.SetFocus()
		RETURN True
	ELSE
//		pb_grabar.Enabled	= True
		RETURN False
	END IF





Return False
end function

public function boolean existearchivo (integer li_cliente, integer li_planta, long ll_guia, long al_planillas, string as_tipoplanilla, string as_instructivo);Date ld_fecha
Time lt_hora
Integer li_contador, li_code_gengde
Long ll_numero
String	ls_embarque

//ls_embarque = String(em_operacion.Text)

SELECT defe_numero
INTO	:ll_numero
FROM	dbo.DESPAFRIGOEN 
WHERE	plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_guides	=	:ll_guia
AND   defe_plasag =  :al_planilla
AND   embq_codigo =  :as_instructivo;

IF sqlca.SQLCode = -1 THEN
	F_ErrorBaseDatos(sqlca,"Lectura de la Tabla DESPAFRIGOEN")
	RETURN True
ELSEIF sqlca.SQLCode = 100 THEN
	MessageBox("Atención", "No existe Número Guia Indicado.~r~rIngrese otro Número.", &
					Exclamation!, Ok!)
	RETURN True
END IF

SELECT count(*),max(CODE_FECHAA),max(CODE_HORAAP)
INTO :li_contador,:ld_fecha,:lt_hora
FROM dbo.CONTROLDESPACHOS
where plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_numero	=	:ll_numero;

IF sqlca.SQLCode = -1 THEN
	F_ErrorBaseDatos(sqlca,"Lectura de la Tabla CONTROLDESPACHOS")
	RETURN True
END IF

IF li_contador > 0 THEN
	
	Select CODE_GEMSAA 
	INTO :li_code_gengde
	from dbo.CONTROLDESPACHOS
	where  plde_codigo =	:li_planta
		AND	clie_codigo =	:li_cliente
		AND	defe_numero =	:ll_numero
		AND	CODE_FECHAA =  :ld_fecha
		AND	CODE_HORAAP = 	:lt_hora;
		
	IF li_code_gengde = 1 THEN
		MessageBox("Atención", "El Archivo S.A.A.M ya Fue Generado.", &
					Exclamation!, Ok!)
		Return True
	END IF		
END IF
Return FALSE
end function

public subroutine enviamailarchivo ();String		ls_Nombre, ls_NomReporte, ls_Archivo, ls_DirectorioAct, ls_correostembex, ls_asunto, ls_texto, ls_ErrorMsg 
Long			ll_Fila, ll_consignatario, ll_Archivo, ll_result
Boolean		lb_Existe
Integer		li_imprimio
String		ls_planta, ls_correoplanta, ls_tipodespa,ls_correoaereo,ls_correoterrestre,ls_correomaritimo
str_parms	lstr_parms

ls_planta = String(dw_1.Object.plde_codigo[1],'0000')

SELECT plde_corplt,plde_corsam,plde_corter,plde_cormat 
INTO :ls_correoplanta,:ls_correoaereo,:ls_correoterrestre,:ls_correomaritimo
FROM dbo.plantadesp
WHERE plde_codigo=:ls_planta;

	// Ejemplo:
	// Se debe llamar la funcion send_mail con los siguientes
	// parametros:
	//   - Smtp server
	//   - Originador del mail (From)
	//   - Destino (To)
	//   - Con Copia (CC)
	//   - Bcc.
	//   - Titulo del correo (subject)
	//   - Texto del mensaje
	//   - Lista de archivos adjuntos (Attach)
	//   - Mensaje de resultado ( si hay error)
	
	// NOTA:
	// Las direcciones de correo deben ir entre signo < y > siempre
	// Si son varias direcciones en alguno de los parametros deben ir
	// Separadas por punto y coma (;)

SetPointer(HourGlass!)

ls_NomReporte									=	is_archivo
lstr_parms.string_arg[1]					=	String(1)
lstr_parms.string_arg[2]					=	is_archivo
lstr_parms.string_arg[3]					=	String(1)

ll_Archivo = 1

lstr_parms.string_arg[ll_Archivo+3]		=	gs_disco+":\GeneradosSAAM\" + is_archivo //+ ".txt"

ls_tipodespa	=	Mid(is_archivo,12,1)

IF Upper(ls_tipodespa) = 'M' THEN
	ls_correostembex = ls_correomaritimo
ELSEIF Upper(ls_tipodespa) = 'A' THEN
	ls_correostembex = ls_correoaereo
ELSEIF Upper(ls_tipodespa) = 'T' THEN
	ls_correostembex = ls_correoterrestre
END IF	

ls_asunto	 = "Envío Documento"
ls_asunto	 =	 lstr_parms.string_arg[2]+' - ' + ls_asunto
ls_texto		 =	 ls_texto + ': '+lstr_parms.string_arg[2]+' con fecha ' + String(Today(),'dd/mm/yyyy')+'.' 

//IF ls_planta = '2' OR ls_planta = '4' THEN
//	IF Upper(ls_tipodespa) = 'P' OR Upper(ls_tipodespa) = 'N' THEN
//		ll_result = send_mail("smtp.entelcloud.cl","<archivostembex"+ls_planta+"@rioblanco.cl>",ls_correoplanta,"","",ls_asunto,ls_texto,lstr_parms.string_arg[ll_Archivo+3],ls_ErrorMsg) 
//	ELSE
//		ll_result = send_mail("smtp.entelcloud.cl","<archivostembex"+ls_planta+"@rioblanco.cl>",ls_correostembex,ls_correoplanta,"",ls_asunto,ls_texto,lstr_parms.string_arg[ll_Archivo+3],ls_ErrorMsg)
//	END IF	
//ELSE	
//	IF Upper(ls_tipodespa) = 'P' OR Upper(ls_tipodespa) = 'N' THEN
//		ll_result = send_mail("smtp.rioblanco.cl","<archivostembex"+ls_planta+"@rioblanco.cl>",ls_correoplanta,"","",ls_asunto,ls_texto,lstr_parms.string_arg[ll_Archivo+3],ls_ErrorMsg)
//	ELSE
//		ll_result = send_mail("smtp.rioblanco.cl","<archivostembex"+ls_planta+"@rioblanco.cl>",ls_correostembex,ls_correoplanta,"",ls_asunto,ls_texto,lstr_parms.string_arg[ll_Archivo+3],ls_ErrorMsg)
//	END IF	
//END IF	

//ll_result = send_mail("smtp.rioblanco.cl","<archivosaam"+ls_planta+"@rioblanco.cl>","<spison@rioblanco.cl>","<icarvallo@rioblanco.cl>"+ls_correoplanta,"",ls_asunto,ls_texto,lstr_parms.string_arg[ll_Archivo+3],ls_ErrorMsg)
	
IF ll_result < 0 THEN
	messagebox("Error en el envio de mail - Error No" + string(ll_result),ls_ErrorMsg+ "~r~nIntente enviar correo en forma manual")
	OpenWithParm(w_correo_archivo_saam, lstr_parms)
ELSE
	Messagebox("Aviso", "Envio de correo exitoso")
END IF

SetPointer(Arrow!)
end subroutine

public function boolean existeoperacion (string operacion);Integer	li_codexp,li_puerto
String	ls_nave, ls_embarque
Date		ld_fzarpe

li_codexp		=	dw_2.GetItemNumber(1,"clie_codigo")
ls_embarque		=	operacion

IF ls_embarque <> "" THEN
	
	SELECT	embq_nomnav, embq_fzarpe, embq_ptoori
		INTO	:ls_nave, :ld_fzarpe, :li_puerto
		FROM	dbo.EMBARQUEPROD
		WHERE	clie_codigo	=	:li_codexp
		AND	embq_codigo =	:ls_embarque ;
				
	IF sqlca.SQLCode = -1 THEN
		F_ErrorBaseDatos(sqlca,"Lectura de la Tabla EMBARQUEPROD")
		RETURN False
	ELSEIF sqlca.SQLCode = 100 THEN
		MessageBox("Atención", "No existe Instructivo Indicada.~r~rIngrese otro Número.", &
						Exclamation!, Ok!)

		RETURN False
	ELSE
		
		SELECT puer_correo
		INTO :is_correosaampuerto
		FROM dbo.puertos 
		WHERE puer_codigo = :li_puerto;

		RETURN True
	END IF
ELSE
	MessageBox("Atención", "Faltan parámetros de búsqueda.~r~rIngreselos todos.", &
					Exclamation!, Ok!)
	RETURN False
END IF
end function

public function boolean wf_actualiza_db (boolean borrando);Boolean	lb_AutoCommit, lb_Retorno

//IF Not dw_2.uf_check_required(0) THEN RETURN False

//IF Not dw_1.uf_validate(0) THEN RETURN False

lb_AutoCommit		=	sqlca.AutoCommit
sqlca.AutoCommit	=	False

IF Borrando THEN
//	IF dw_1.Update(True, False) = 1 THEN
//		IF dw_2.Update(True, False) = 1 THEN
//			Commit;
//			
//			IF sqlca.SQLCode <> 0 THEN
//				F_ErrorBaseDatos(sqlca, This.Title)
//				
//				RollBack;
//			ELSE
//				lb_Retorno	=	True
//				
//				dw_1.ResetUpdate()
//				dw_2.ResetUpdate()
//			END IF
//		ELSE
//			F_ErrorBaseDatos(sqlca, This.Title)
//			
//			RollBack;
//		END IF
//	ELSE
//		F_ErrorBaseDatos(sqlca, This.Title)
//	END IF
ELSE
//	IF dw_2.Update(True, False) = 1 THEN
		IF dw_4.Update(True, False) = 1 THEN
			Commit;
			
			IF sqlca.SQLCode <> 0 THEN
				F_ErrorBaseDatos(sqlca, This.Title)
				
				RollBack;
			ELSE
				lb_Retorno	=	True
				
				//dw_1.ResetUpdate()
				//dw_2.ResetUpdate()
				dw_4.ResetUpdate()
			END IF
		ELSE
			F_ErrorBaseDatos(sqlca, This.Title)
			
			RollBack;
		END IF
//	ELSE
//		F_ErrorBaseDatos(sqlca, This.Title)
//	END IF
END IF

sqlca.AutoCommit	=	lb_AutoCommit

RETURN lb_Retorno
end function

public subroutine generaarchivostembex ();Long			ll_fila, ll_filas, ll_filadet, ll_guia, ll_numero, ll_cont, ll_planilla, ll_filcont, ll_pallet, ll_despacho, ll_existe, ll_fiborra
String		ls_Cliente, ls_Planta, ls_Patente, ls_Archivo, ls_Registro, ls_embarque, ls_estdespacho, ls_paen_estdes,&
				ls_termog, ls_guia, ls_Instructivo, ls_tipodespa
double		ll_termog
Integer		li_copallet, li_cliente, li_planta, li_Tipova
Datetime    ldt_hora
Boolean		rtn

ldt_hora			=	Datetime(Date(Today()),Time(Today())	)

dw_6.DataObject = "dw_info_archivo_stembex_packing_nuevo"
dw_7.DataObject = "dw_gene_archivo_saam_plano_nuevo"
dw_4.DataObject = "dw_gene_archivo_saam_estado_nuevo"

dw_6.reset()
dw_7.reset()
dw_4.reset()
dw_5.reset()

li_planta = dw_1.Object.plde_codigo[1]

dw_7.SetTransObject(Sqlca)
dw_6.SetTransObject(Sqlca)

// Para actualizar el estado=1 Cerrado, una vez generado el archivo
dw_4.SetTransObject(SQLCA)
dw_5.SetTransObject(SQLCA)
dw_guia.SetTransObject(SQLCA)

ls_Cliente		=	String(Integer(istr_mant.Argumento[1]), '000')
ls_Planta		=	String(Integer(istr_mant.Argumento[2]), '0000')
ls_guia 			=  em_nroguia.Text
ll_guia 			=  Long(em_nroguia.Text)
ls_Instructivo	=	is_embarque
ls_embarque		=	is_embarque
ll_planilla		=	al_planilla

ls_Archivo	=  "STEMBEX" +ls_Instructivo+"-"+ string(ll_planilla) + "." + Mid(ls_Planta, 2, 3) + ls_guia
is_archivo	=	ls_Archivo

ll_filcont		=  dw_5.Retrieve(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),&
										ll_planilla,ii_var,ii_cal,ii_prod,ll_guia, 0, '-1',ls_Instructivo)
IF ll_filcont > 0 THEN
//	IF valida_datos() THEN
//		Return
//	END IF	
END IF	

ll_filas			=  dw_6.Retrieve(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),&
										ll_planilla,ii_var,ii_cal,ii_prod,ll_guia, 0, '-1',ls_Instructivo)
									  
li_cliente = Integer(istr_mant.argumento[1])

IF ll_filas = -1 THEN
	F_ErrorBaseDatos(sqlca,"Lectura de la Tabla EMBARQUEPROD")
ELSEIF ll_filas = 0 THEN
	MessageBox("Atención", "No hay información con Operación Indicada.~r~rIngrese otra Operación.", &
					Exclamation!, Ok!)
ELSE
	dw_6.SetSort('paen_numero')
   dw_6.Sort()

	FOR ll_fila = 1 TO ll_filas
		ls_Patente	=	String(dw_6.Object.defe_patent[ll_fila])
		
		IF IsNull(ls_Patente) THEN ls_Patente = ''
		
		ls_Registro	=	dw_6.Object.embq_codigo[ll_fila]
		ls_Registro	+=	String(dw_6.Object.defe_guides[ll_fila], '00000000')
		ls_Registro	+=	String(dw_6.Object.reci_codigo[ll_fila], '00000')
		ls_Registro	+=	String(dw_6.Object.plde_codigo[ll_fila], '0000')
		//ls_Registro	+=	ls_Patente + Fill(' ',6 - Len(ls_Patente))
		ls_Registro	+=	String(mid(ls_Patente,1,6),'@@@@@@')			
		ls_Registro	+=	String(dw_6.Object.espe_codigo[ll_fila], '00')
				
		Obtiene_condicion(dw_6.Object.clie_codigo[ll_fila],dw_6.Object.plde_codigo[ll_fila],dw_6.Object.paen_numero[ll_fila])
		
		ls_Registro	+=	String(ii_condicion,'0')
		ls_Registro	+=	ls_Cliente
		ls_Registro	+=	String(dw_6.Object.paen_numero[ll_fila], '0000000')
		ll_pallet 	 = dw_6.Object.paen_numero[ll_fila]
		ls_Registro	+=	String(dw_6.Object.etiq_codigo[ll_fila], '000')
		ls_Registro	+=	String(dw_6.Object.paen_fecemb[ll_fila], 'ddmmyy')
		ls_Registro	+=	String(dw_6.Object.prod_codigo[ll_fila], '00000')
		ls_Registro	+=	String(dw_6.Object.emba_codigo[ll_fila], '@@@@@@@@@@')
		ls_Registro	+=	String(dw_6.Object.vari_codigo[ll_fila], '0000')
		ls_Registro	+=	String(dw_6.Object.pafr_calibr[ll_fila], '@@@')
		ls_Registro	+=	String(dw_6.Object.pafr_ccajas[ll_fila], '0000000')
		ls_Registro	+=	String(dw_6.Object.cate_codigo[ll_fila], '000')
		ls_Registro	+=	String(dw_6.Object.tica_codigo[ll_fila],'0')
		ls_Registro	+=	String(dw_6.Object.embq_ptoori[ll_fila], '000')
		ls_Registro += String(dw_6.Object.packing[ll_fila], '0000')

		IF IsNull(dw_6.Object.defe_termog[ll_fila]) THEN
			ll_termog = 0
			ls_termog = '0'
		ELSE
			ls_termog = String(dw_6.Object.defe_termog[ll_fila])
		END IF
	   ls_Registro +=String(ls_termog, Fill("@", 15))
		
		IF IsNull(dw_6.Object.copa_codigo[ll_fila]) THEN
			li_copallet	= 	0
		ELSE
			li_copallet =	dw_6.Object.copa_codigo[ll_fila]
		END IF
	   ls_Registro +=String(li_copallet, Fill("0", 3))
		ls_Registro += String(dw_6.Object.paen_inspec[ll_fila],'0')
		
		li_planta = Integer(istr_mant.Argumento[2])
						
		SELECT isnull(paen_estdes,'')
		INTO :ls_estdespacho
		FROM dbo.palletencab
		WHERE clie_codigo = :li_cliente
		AND plde_codigo = :li_planta
		AND paen_numero = : ll_pallet; 
		COMMIT;
		
		IF ls_estdespacho = '' THEN
			ls_paen_estdes = 'A'
			
			UPDATE dbo.palletencab SET
			paen_estdes = :ls_paen_estdes
			WHERE clie_codigo = :li_cliente
			AND plde_codigo = :li_planta
			AND paen_numero = : ll_pallet;
			COMMIT;
			
		ELSEIF ls_estdespacho = 'M' THEN	
			ls_paen_estdes = 'M'
		ELSEIF ls_estdespacho = 'A' THEN	
			ls_paen_estdes = 'A'	
		ELSEIF ls_estdespacho = 'E' THEN	
			ls_paen_estdes = ' '	
		END IF
					
		ls_Registro += 'A'//ls_paen_estdes
		
		ls_Registro += String(dw_6.Object.defe_nrcont[ll_fila],'@@@@@@@@@@@@@@@@@@@@')
		ls_Registro += String(dw_6.Object.listasellos[ll_fila],'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@')
		ls_Registro += String(dw_6.Object.defe_chofer[ll_fila],'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@')
		ls_Registro += String(dw_6.Object.defe_celcho[ll_fila],'@@@@@@@@@@@@@@@')
		ls_Registro += String(dw_6.Object.defe_pataco[ll_fila],'@@@@@@@@@@@@@@@')
		ls_Registro += String(dw_6.Object.hora[ll_fila],'00')
		ls_Registro += String(dw_6.Object.minutos[ll_fila],'00')
		ls_Registro += String(dw_6.Object.puer_codigo[ll_fila],'000')
					
		ll_filadet	=	dw_7.InsertRow(0)
		dw_7.Object.registro[ll_filadet]	=	ls_Registro

		IF existearchivo(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),dw_6.Object.defe_guides[ll_fila],&
			al_planilla,String(-1),ls_Instructivo) THEN
			Return
		END IF
	NEXT
	
//	dw_8.SetTransObject(Sqlca)
//	ll_despacho =	dw_6.Object.defe_numero[1]
//	
//	ll_existe = dw_8.Retrieve(li_cliente,li_planta,ll_despacho)
//	
//	IF ll_existe > 0 THEN
//		FOR ll_fiborra = 1 TO dw_8.RowCount()
//			ls_Registro	=	dw_8.Object.embq_codigo[ll_fiborra]
//			ls_Registro	+=	String(dw_8.Object.defe_guides[ll_fiborra], '00000000')
//			ls_Registro	+=	String(dw_8.Object.plde_codigo[ll_fiborra], '0000')
//			ls_Registro	+=	String('000000000000000')
//			ls_Registro	+=	String(li_cliente)
//			ls_Registro	+=	String(dw_8.Object.paen_numero[ll_fiborra], '0000000')
//			ls_Registro	+=	String('00000000000000000000000000000000000000000000000000000000000000000000')
//			ls_Registro += String(dw_8.Object.borr_estado[ll_fiborra], '@')
//			
//			ll_filadet	=	dw_7.InsertRow(0)
//			dw_7.Object.registro[ll_filadet]	=	ls_Registro
//		NEXT	
//	END IF
	
	IF dw_7.SaveAs(gs_disco+":\GeneradosSAAM\" + ls_Archivo, Text!, False) = -1 THEN
		MessageBox("Atención","No se pudo generar el archivo " + ls_Archivo)
	ELSE	
		
//mover a solo correos stembex		

	ls_tipodespa	=	Mid(is_archivo,12,1)
	
	IF Upper(ls_tipodespa) = 'M' OR Upper(ls_tipodespa) = 'A' OR Upper(ls_tipodespa) = 'T' THEN
		string ls_parm
		uint ll_ret
		Integer	li_FileNum
		ls_parm = ""
		
		li_FileNum = FileOpen(gs_disco+":\GeneradosSaam\upload.bat",LineMode!, Write!, LockWrite!, Append!)
		 
		FileWrite(li_FileNum, '@echo off')       
		FileWrite(li_FileNum, 'ftp -s:upload.txt')
		FileWrite(li_FileNum, 'echo Archivos Subidos > "' + gs_disco+':\GeneradosSaam\upload.res"')
		FileClose(li_FileNum)
		
		li_FileNum = FileOpen( gs_disco+":\GeneradosSaam\upload.txt",LineMode!, Write!, LockWrite!, Append!)
				 
		FileWrite(li_FileNum, 'open')
		FileWrite(li_FileNum, 'stembex.rioblanco.cl')
		FileWrite(li_FileNum, 'stembex')
		FileWrite(li_FileNum, 'st3mb3x.,2014')
		FileWrite(li_FileNum, 'binary')
		FileWrite(li_FileNum, 'cd ' + 'Temporada2013_2014/ArchivosPlanta_a_Stembex')
		
		FileWrite(li_FileNum, 'put ' + gs_disco+':\GeneradosSaam\'+ls_Archivo)
		
		FileWrite(li_FileNum, 'bye')
		FileClose(li_FileNum)
		
		ll_ret = ShellExecuteW( handle ( this ) , "open" , "upload.bat" , ls_parm , gs_disco+':\GeneradosSaam' , 0 )
		
		DO WHILE NOT FileExists(gs_disco+":\GeneradosSaam\upload.res")
		 SetPointer(HourGlass!)
		 Yield()
		LOOP
		
		DO WHILE FileExists(gs_disco+":\GeneradosSaam\upload.res")
		 FileDelete(gs_disco+":\GeneradosSaam\upload.res")
		LOOP
		
		IF ll_ret > 32 THEN
		 FileDelete(gs_disco+":\GeneradosSaam\upload.bat")
		 FileDelete(gs_disco+":\GeneradosSaam\upload.txt")
		END IF
	
	END IF
   	dw_7.Reset()
		
		enviamailarchivo()
				
		MessageBox("Atención", "Archivo " + ls_Archivo + " Generado. Avise a Computación", &
							Exclamation!, Ok!)
		
		ll_filas		=  dw_4.Retrieve(Integer(istr_mant.argumento[1]), &
									  Integer(istr_mant.argumento[2]),al_planilla,ll_guia,'-1',ls_Instructivo)
									  
		IF ll_filas = -1 THEN
			F_ErrorBaseDatos(sqlca,"Lectura de la Tabla DESPAFRIGOEN")
		ELSEIF ll_filas = 0 THEN
			MessageBox("Atención", "No hay información ", &
							Exclamation!, Ok!)
		ELSE		
			FOR ll_fila	= 1 TO ll_filas
				dw_4.SetItem(ll_fila,'defe_estado',1)
				ll_numero  = dw_4.Object.defe_numero[ll_fila]
				li_cliente = dw_4.Object.clie_codigo[ll_fila]
				li_planta  = dw_4.Object.plde_codigo[ll_fila]
				
		   NEXT
			wf_actualiza_db(False)
		END IF
									  
	END IF

END IF

MESSAGEBOX("ATENCION","ARCHIVO STEMBEX ENVIADO A OFICINA CENTRAL")
end subroutine

protected function integer despacho (integer li_cliente, integer li_planta, long ll_guia);Long ll_numero
Integer li_contador
Datetime    ldt_hora, ld_fecha
Time			ld_hora

ldt_hora			=	Datetime(Date(Today()),Time(Today())	)

SELECT defe_numero
INTO	:ll_numero
FROM	dbo.DESPAFRIGOEN 
WHERE	plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_guides	=	:ll_guia;

IF sqlca.SQLCode = -1 THEN
	F_ErrorBaseDatos(sqlca,"Lectura de la Tabla DESPAFRIGOEN")
	RETURN 0
ELSEIF sqlca.SQLCode = 100 THEN
	MessageBox("Atención", "No existe Número Guia Despacho Indicado.~r~rIngrese otro Número.", &
					Exclamation!, Ok!)
	RETURN 0
END IF

ii_controlstembex = 0

SELECT max(CODE_FECHAA)
INTO :ld_fecha
FROM dbo.CONTROLDESPACHOS
where plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_numero	=	:ll_numero;

SELECT max(CODE_HORAAP)
INTO :ld_hora
FROM dbo.CONTROLDESPACHOS
where plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_numero	=	:ll_numero
AND   CODE_FECHAA =  :ld_fecha;

SELECT isnull(CODE_GENGDE,0)
INTO :ii_controlstembex
FROM dbo.CONTROLDESPACHOS
where plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_numero	=	:ll_numero
AND   CODE_FECHAA =  :ld_fecha
AND	Datediff(ss, CODE_HORAAP, :ld_hora) = 0;

SELECT count(*)
INTO :li_contador
FROM dbo.CONTROLDESPACHOS
where plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_numero	=	:ll_numero
AND   CODE_FECHAA =  :ld_fecha
AND	Datediff(ss, CODE_HORAAP, :ld_hora) = 0;

IF sqlca.SQLCode = -1 THEN
	F_ErrorBaseDatos(sqlca,"Lectura de la Tabla CONTROLDESPACHOS")
	RETURN 0
END IF

IF li_contador > 0 THEN
	IF ii_tipo = 1 THEN
		UPDATE dbo.CONTROLDESPACHOS Set 
		CODE_GENGDE = 1,
		CODE_FECGDE = :ldt_hora
   	WHERE  plde_codigo =	:li_planta
		AND	 clie_codigo =	:li_cliente
		AND	 defe_numero =	:ll_numero
		AND    CODE_FECHAA = :ld_fecha
      	AND	Datediff(ss, CODE_HORAAP, :ld_hora) = 0;
		Commit;
		
		IF sqlca.SQLCode = -1 THEN
			F_ErrorBaseDatos(sqlca,"Lectura de la Tabla CONTROLDESPACHOS")
			RETURN 0
		END IF
		
		UPDATE dbo.CONTROLDESPACHOS Set 
		CODE_GEMIDE = 1
   	WHERE  plde_codigo =	:li_planta
		AND	 clie_codigo =	:li_cliente
		AND	 defe_numero =	:ll_numero
		AND   CODE_FECHAA =  :ld_fecha
		AND	Datediff(ss, CODE_HORAAP, :ld_hora) = 0;
		Commit;
//	ELSEIF ii_tipo = 2 THEN	
//		update dbo.CONTROLDESPACHOS Set 
//		CODE_GEMIDE = 1
//   	where  plde_codigo =	:li_planta
//		AND	 clie_codigo =	:li_cliente
//		AND	 defe_numero =	:ll_numero;
//		Commit;
	ELSE	
		UPDATE dbo.CONTROLDESPACHOS Set 
		CODE_DEMADE = 1
   	WHERE  plde_codigo =	:li_planta
		AND	 clie_codigo =	:li_cliente
		AND	 defe_numero =	:ll_numero
		AND    CODE_FECHAA = :ld_fecha
		AND	Datediff(ss, CODE_HORAAP, :ld_hora) = 0;
		Commit;
	END IF	
END IF	
return 0



end function

public function boolean validadespacho (integer li_cliente, integer li_planta, long ll_guia);Long ll_numero
Integer li_contador, li_count, li_code_gengde, li_code_gemide, li_code_demade
Date ld_fecha
Time lt_hora
String	ls_embarque

//ls_embarque = String(em_operacion.Text)

SELECT max(defe_numero)
INTO	:ll_numero
FROM	dbo.DESPAFRIGOEN 
WHERE	plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_guides	=	:ll_guia;

IF sqlca.SQLCode = -1 THEN
		F_ErrorBaseDatos(sqlca,"Lectura de la Tabla DESPAFRIGOEN")
		RETURN True
	ELSEIF sqlca.SQLCode = 100 THEN
		MessageBox("Atención", "No existe Número Guia Indicado.~r~rIngrese otro Número.", &
						Exclamation!, Ok!)
		RETURN True
END IF

SELECT count(*),max(CODE_FECHAA),max(CODE_HORAAP)
INTO :li_contador,:ld_fecha,:lt_hora
FROM dbo.CONTROLDESPACHOS
where plde_codigo =	:li_planta
AND	clie_codigo	=	:li_cliente
AND	defe_numero	=	:ll_numero;

IF sqlca.SQLCode = -1 THEN
		F_ErrorBaseDatos(sqlca,"Lectura de la Tabla CONTROLDESPACHOS")
		RETURN True
END IF

IF li_contador > 0 THEN
//	Select CODE_GENGDE 
//	INTO :li_code_gengde
//	from dbo.CONTROLDESPACHOS
//	where  plde_codigo =	:li_planta
//		AND	clie_codigo =	:li_cliente
//		AND	defe_numero =	:ll_numero
//		AND	CODE_FECHAA =  :ld_fecha;
//		
//	IF Isnull(li_code_gengde) OR li_code_gengde = 0 THEN
//		MessageBox("Atención", "Falta Generar Informe de Guía de Despacho.", &
//					Exclamation!, Ok!)
//		Return True
//	END IF		
		
END IF	

IF li_contador > 0 THEN
//	Select CODE_GEMIDE 
//	INTO :li_code_gemide
//	from dbo.CONTROLDESPACHOS
//	where  plde_codigo =	:li_planta
//		AND	clie_codigo =	:li_cliente
//		AND	defe_numero =	:ll_numero
//		AND	CODE_FECHAA =  :ld_fecha;
//		
//	IF Isnull(li_code_gemide) OR li_code_gemide = 0 THEN
//		MessageBox("Atención", "Falta Generar Impresión de Despacho.", &
//					Exclamation!, Ok!)
//		Return True
//	END IF		
//	
END IF	

IF li_contador > 0 THEN
	Select CODE_DEMADE 
	INTO :li_code_demade
	from dbo.CONTROLDESPACHOS
	where  plde_codigo =	:li_planta
		AND	clie_codigo =	:li_cliente
		AND	defe_numero =	:ll_numero
		AND	CODE_FECHAA =  :ld_fecha;
	
	IF Isnull(li_code_demade) OR li_code_demade = 0 THEN
		MessageBox("Atención", "Falta Generar Listado Anexo de Despacho.", &
					Exclamation!, Ok!)
		Return True
	END IF		
	
END IF	

return False			
			

end function

public function boolean existe_exportador (integer ai_exportador);String	ls_nombre, ls_rut

SELECT expo_nombre,	expo_rutexp
	INTO	:is_nombrexpo, :is_rutexpo
	FROM	dbo.exportadores
	WHERE	expo_codigo	=	:ai_exportador;
				
	IF sqlca.SQLCode = -1 THEN
		F_ErrorBaseDatos(sqlca,"Lectura de la Tabla exportadores")
	Return False
	
	ELSEIF sqlca.SQLCode = 100 THEN
		MessageBox("Atención", "No Existe Exportador.~r~rIngrese otro Número.", &
						Exclamation!, Ok!)
		Return False		
	ELSE
		em_rutexpo.Text 		= is_rutexpo
		em_exportador.Text 	= is_nombrexpo
	END IF
	Return True
end function

public function boolean busca_nombre (integer ai_cliente);Integer	li_codexp, li_planta

SELECT expo_nombre,expo_rutexp
	INTO	:is_nombrexpo,:is_rutexpo
	FROM	dbo.exportadores
	WHERE	expo_codigo	=	:ai_cliente;
				
If sqlca.SQLCode = -1 Then
	F_ErrorBaseDatos(sqlca,"Lectura de la Tabla exportadores")
Return False

ElseIf sqlca.SQLCode = 100 Then
	MessageBox("Atención", "No Existe Exportador.~r~rIngrese otro Número.", &
					Exclamation!, Ok!)
	Return False						
End If

Return True
end function

on w_info_guia_despacho.create
int iCurrent
call super::create
this.st_1=create st_1
this.st_2=create st_2
this.dw_2=create dw_2
this.st_6=create st_6
this.dw_1=create dw_1
this.em_nroguia=create em_nroguia
this.gb_3=create gb_3
this.cbx_1=create cbx_1
this.cbx_2=create cbx_2
this.cbx_3=create cbx_3
this.cbx_4=create cbx_4
this.st_3=create st_3
this.st_5=create st_5
this.st_7=create st_7
this.st_8=create st_8
this.em_recibidor=create em_recibidor
this.em_rut=create em_rut
this.em_direccion=create em_direccion
this.cbx_5=create cbx_5
this.st_9=create st_9
this.em_observa=create em_observa
this.dw_guia=create dw_guia
this.cbx_6=create cbx_6
this.cbx_7=create cbx_7
this.cbx_8=create cbx_8
this.st_13=create st_13
this.em_nomdespachador=create em_nomdespachador
this.st_10=create st_10
this.em_tipomv=create em_tipomv
this.em_puerto=create em_puerto
this.em_destino=create em_destino
this.st_11=create st_11
this.st_12=create st_12
this.st_14=create st_14
this.em_nominspector=create em_nominspector
this.gb_frio=create gb_frio
this.cbx_frio=create cbx_frio
this.gb_4=create gb_4
this.st_4=create st_4
this.cbx_id=create cbx_id
this.em_glosaespecial=create em_glosaespecial
this.st_15=create st_15
this.cbx_sdp=create cbx_sdp
this.mle_condicion=create mle_condicion
this.st_22=create st_22
this.st_16=create st_16
this.cbx_archivo=create cbx_archivo
this.cbx_9=create cbx_9
this.st_17=create st_17
this.em_numsellos=create em_numsellos
this.st_18=create st_18
this.em_ubisellos=create em_ubisellos
this.dw_3=create dw_3
this.em_cansellos=create em_cansellos
this.cbx_valores=create cbx_valores
this.st_19=create st_19
this.em_ciudad=create em_ciudad
this.cbx_csg=create cbx_csg
this.dw_4=create dw_4
this.dw_5=create dw_5
this.dw_6=create dw_6
this.dw_7=create dw_7
this.dw_8=create dw_8
this.dw_tipopallet=create dw_tipopallet
this.dw_etiqueta=create dw_etiqueta
this.st_20=create st_20
this.em_exportador=create em_exportador
this.em_rutexpo=create em_rutexpo
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.st_1
this.Control[iCurrent+2]=this.st_2
this.Control[iCurrent+3]=this.dw_2
this.Control[iCurrent+4]=this.st_6
this.Control[iCurrent+5]=this.dw_1
this.Control[iCurrent+6]=this.em_nroguia
this.Control[iCurrent+7]=this.gb_3
this.Control[iCurrent+8]=this.cbx_1
this.Control[iCurrent+9]=this.cbx_2
this.Control[iCurrent+10]=this.cbx_3
this.Control[iCurrent+11]=this.cbx_4
this.Control[iCurrent+12]=this.st_3
this.Control[iCurrent+13]=this.st_5
this.Control[iCurrent+14]=this.st_7
this.Control[iCurrent+15]=this.st_8
this.Control[iCurrent+16]=this.em_recibidor
this.Control[iCurrent+17]=this.em_rut
this.Control[iCurrent+18]=this.em_direccion
this.Control[iCurrent+19]=this.cbx_5
this.Control[iCurrent+20]=this.st_9
this.Control[iCurrent+21]=this.em_observa
this.Control[iCurrent+22]=this.dw_guia
this.Control[iCurrent+23]=this.cbx_6
this.Control[iCurrent+24]=this.cbx_7
this.Control[iCurrent+25]=this.cbx_8
this.Control[iCurrent+26]=this.st_13
this.Control[iCurrent+27]=this.em_nomdespachador
this.Control[iCurrent+28]=this.st_10
this.Control[iCurrent+29]=this.em_tipomv
this.Control[iCurrent+30]=this.em_puerto
this.Control[iCurrent+31]=this.em_destino
this.Control[iCurrent+32]=this.st_11
this.Control[iCurrent+33]=this.st_12
this.Control[iCurrent+34]=this.st_14
this.Control[iCurrent+35]=this.em_nominspector
this.Control[iCurrent+36]=this.gb_frio
this.Control[iCurrent+37]=this.cbx_frio
this.Control[iCurrent+38]=this.gb_4
this.Control[iCurrent+39]=this.st_4
this.Control[iCurrent+40]=this.cbx_id
this.Control[iCurrent+41]=this.em_glosaespecial
this.Control[iCurrent+42]=this.st_15
this.Control[iCurrent+43]=this.cbx_sdp
this.Control[iCurrent+44]=this.mle_condicion
this.Control[iCurrent+45]=this.st_22
this.Control[iCurrent+46]=this.st_16
this.Control[iCurrent+47]=this.cbx_archivo
this.Control[iCurrent+48]=this.cbx_9
this.Control[iCurrent+49]=this.st_17
this.Control[iCurrent+50]=this.em_numsellos
this.Control[iCurrent+51]=this.st_18
this.Control[iCurrent+52]=this.em_ubisellos
this.Control[iCurrent+53]=this.dw_3
this.Control[iCurrent+54]=this.em_cansellos
this.Control[iCurrent+55]=this.cbx_valores
this.Control[iCurrent+56]=this.st_19
this.Control[iCurrent+57]=this.em_ciudad
this.Control[iCurrent+58]=this.cbx_csg
this.Control[iCurrent+59]=this.dw_4
this.Control[iCurrent+60]=this.dw_5
this.Control[iCurrent+61]=this.dw_6
this.Control[iCurrent+62]=this.dw_7
this.Control[iCurrent+63]=this.dw_8
this.Control[iCurrent+64]=this.dw_tipopallet
this.Control[iCurrent+65]=this.dw_etiqueta
this.Control[iCurrent+66]=this.st_20
this.Control[iCurrent+67]=this.em_exportador
this.Control[iCurrent+68]=this.em_rutexpo
end on

on w_info_guia_despacho.destroy
call super::destroy
destroy(this.st_1)
destroy(this.st_2)
destroy(this.dw_2)
destroy(this.st_6)
destroy(this.dw_1)
destroy(this.em_nroguia)
destroy(this.gb_3)
destroy(this.cbx_1)
destroy(this.cbx_2)
destroy(this.cbx_3)
destroy(this.cbx_4)
destroy(this.st_3)
destroy(this.st_5)
destroy(this.st_7)
destroy(this.st_8)
destroy(this.em_recibidor)
destroy(this.em_rut)
destroy(this.em_direccion)
destroy(this.cbx_5)
destroy(this.st_9)
destroy(this.em_observa)
destroy(this.dw_guia)
destroy(this.cbx_6)
destroy(this.cbx_7)
destroy(this.cbx_8)
destroy(this.st_13)
destroy(this.em_nomdespachador)
destroy(this.st_10)
destroy(this.em_tipomv)
destroy(this.em_puerto)
destroy(this.em_destino)
destroy(this.st_11)
destroy(this.st_12)
destroy(this.st_14)
destroy(this.em_nominspector)
destroy(this.gb_frio)
destroy(this.cbx_frio)
destroy(this.gb_4)
destroy(this.st_4)
destroy(this.cbx_id)
destroy(this.em_glosaespecial)
destroy(this.st_15)
destroy(this.cbx_sdp)
destroy(this.mle_condicion)
destroy(this.st_22)
destroy(this.st_16)
destroy(this.cbx_archivo)
destroy(this.cbx_9)
destroy(this.st_17)
destroy(this.em_numsellos)
destroy(this.st_18)
destroy(this.em_ubisellos)
destroy(this.dw_3)
destroy(this.em_cansellos)
destroy(this.cbx_valores)
destroy(this.st_19)
destroy(this.em_ciudad)
destroy(this.cbx_csg)
destroy(this.dw_4)
destroy(this.dw_5)
destroy(this.dw_6)
destroy(this.dw_7)
destroy(this.dw_8)
destroy(this.dw_tipopallet)
destroy(this.dw_etiqueta)
destroy(this.st_20)
destroy(this.em_exportador)
destroy(this.em_rutexpo)
end on

event open;call super::open;Boolean rtn

ii_tipo	=	Integer(Message.StringParm)

//cbx_csg.Visible = False
//cbx_csg.Checked = False

If gi_vari_rotulada = 1 Then
	cbx_1.Checked	= True
	cbx_1.Enabled	= False
	ii_var=1
Else
	cbx_1.Checked	= False
	cbx_1.Enabled	= True
	ii_var=0
End If	

If gi_prod_rotulado = 1 Then
	cbx_2.Checked	= True
	cbx_2.Enabled	= False
	ii_prod 	=	1
Else
	cbx_1.Checked	= False
	cbx_1.Enabled	= True
	ii_prod 	=	0
End If	

If gi_cali_rotulado = 1 Then
	cbx_3.Checked	= True
	cbx_3.Enabled	= False
	ii_cal 	=	1
Else
	cbx_3.Checked	= False
	cbx_3.Enabled	= True
	ii_cal 	=	0
End If	

If gi_pack_rotulado = 1 Then
	cbx_5.Checked	= True
	cbx_5.Enabled	= False
	ii_pakrot 	=	1
Else
	cbx_5.Checked	= False
	cbx_5.Enabled	= True
	ii_pakrot 	=	0
End If	

//ii_var	= gi_vari_rotulada
cbx_archivo.visible	=	False

Choose Case ii_tipo
	Case 1
		is_report					=	'dw_info_guia_despacho_cal'
		dw_guia.DataObject	= 'dw_info_guia_despacho_cal'
		st_titulo.Text		 	=	'Emisión Guia de Despacho'
		
		gb_4.Visible 			= True
		cbx_6.Visible 			= True
		cbx_7.Visible 			= True
		cbx_8.Visible 			= True
		em_puerto.Enabled	= True
		gb_frio.Visible 			=  False
		cbx_frio.Visible 		=  False
		cbx_9.Visible 			=  True
	Case 2
		is_report			=	'dw_impresion_despacho'
		st_titulo.Text	=	'Emisión Informe de Despacho'
		gb_frio.Visible 	=  False
		cbx_frio.Visible =  False
	Case 3
		is_report		 		=	'dw_info_anexo_guia_despacho'
		st_titulo.Text	 	=	'Emisión Anexo Guia de Despacho'
		gb_frio.Visible 		=  True
		cbx_frio.Visible 	=  True
		cbx_archivo.visible	=	True
		ids_archivo			=	CREATE	DataStore
//		cbx_csg.Visible 		= True	
End Choose

cbx_id.Visible		= False

If ii_tipo = 3 Then
	cbx_5.Visible 			= True
	em_puerto.Enabled 	= True
	em_destino.Enabled 	= True
	cbx_id.Visible			= True
//	cbx_sdp.Visible		= True	
	cbx_valores.Visible 	= False
Else	
	cbx_5.Visible 			= False
	cbx_valores.Visible	= True
End If

dw_2.GetChild("clie_codigo", idwc_cliente)
idwc_cliente.SetTransObject(SQLCA)
idwc_cliente.Retrieve()
dw_2.InsertRow(0)
dw_2.SetItem(1,"clie_codigo", gi_codexport)

dw_1.GetChild("plde_codigo", idwc_planta)
idwc_planta.SetTransObject(sqlca)
idwc_planta.Retrieve(1)
dw_1.InsertRow(0)
dw_1.SetItem(1,"plde_codigo", gi_codplanta)

istr_mant.argumento[1] =String(gi_codexport)
istr_mant.argumento[2] =String(gi_codplanta)
dw_3.SetTransObject(sqlca)

iuo_Plantas	=	Create uo_Plantadesp

If gi_codplanta <> 81 Then
	em_glosaespecial.Enabled = False
Else	
	em_glosaespecial.Enabled = True
End If	
end event

event resize;//
end event

type pb_excel from w_para_informes`pb_excel within w_info_guia_despacho
end type

type st_computador from w_para_informes`st_computador within w_info_guia_despacho
integer x = 1705
integer width = 1088
end type

type st_usuario from w_para_informes`st_usuario within w_info_guia_despacho
integer x = 1705
integer width = 1088
end type

type st_temporada from w_para_informes`st_temporada within w_info_guia_despacho
integer x = 1705
integer width = 1088
end type

type p_logo from w_para_informes`p_logo within w_info_guia_despacho
string picturename = "\Desarrollo 17\Imagenes\Logos\RBlanco.jpg"
end type

type st_titulo from w_para_informes`st_titulo within w_info_guia_despacho
integer y = 248
integer width = 2107
string text = "Emisión Guia de Despacho"
end type

type pb_acepta from w_para_informes`pb_acepta within w_info_guia_despacho
event ue_imprimir ( )
integer x = 2510
integer y = 1828
integer taborder = 250
end type

event pb_acepta::clicked;SetPointer(HourGlass!)

Integer	fila, li_planta, li_cliente,li_tipoembq, li_vari, li_emba, li_calib, li_frio = 0, li_marca = 1
Long		ll_nroguia, ll_Fila, li_control = 0, ll_filpallet, ll_filetiqueta, ll_guia, ll_planilla, ll_filcont
String		ls_cliente, ls_planta, ls_DirectorioAct, ls_Archivo, ls_FtoGuiaDespa, ls_tipoIns,&
			ls_Ruta, ls_parteemb, ls_texto, ls_Instructivo, ls_embarque

li_cliente	=	Integer(istr_mant.argumento[1])

If ii_cli = 1 Then
  SELECT clie_rnombr, clie_ftodes
    INTO :ls_cliente  , :ls_FtoGuiaDespa
    FROM dbo.clientesprod  
   WHERE clie_codigo= :li_cliente;	
Else
	//ls_cliente	=	idwc_cliente.GetItemString(idwc_cliente.GetRow(),"clie_nombre")
	SELECT clie_nombre , clie_ftodes 
    INTO :ls_cliente  , :ls_FtoGuiaDespa
    FROM dbo.clientesprod  
   WHERE clie_codigo= :li_cliente;
End If

ls_planta	=	idwc_planta.GetItemString(idwc_planta.GetRow(),"plde_nombre")
istr_info.titulo	= 'EMISION GUIA DE DESPACHO'
ls_tipoIns = String(mle_condicion.Text)
OpenWithParm(vinf, istr_info)

dw_guia.SetTransObject(sqlca)
li_planta	=	Integer(istr_mant.argumento[2])
ll_nroguia	=	Long(em_nroguia.Text)

SELECT defe_tiposa
	INTO	:li_tipoembq
	FROM	dbo.DESPAFRIGOEN 
	WHERE	plde_codigo =	:li_planta
	AND	clie_codigo	=	:li_cliente
	AND	defe_guides	=	:ll_nroguia;

If ii_tipo	=	3  Then
	DataWindowChild	ldwc_ptoori, ldwc_ptodes, ldwc_planta, ldwc_plades
	vinf.dw_1.GetChild("plde_codigo", ldwc_planta)
//	vinf.dw_1.GetChild("embarqueprod_puer_codigo", ldwc_ptodes)
//	vinf.dw_1.GetChild("embarqueprod_embq_ptoori", ldwc_ptoori)
//	vinf.dw_1.GetChild("despafrigoen_defe_plades", ldwc_plades)
		
	ldwc_planta.SetTransObject(sqlca)
//	ldwc_ptodes.SetTransObject(sqlca)
//	ldwc_ptoori.SetTransObject(sqlca)
//	ldwc_plades.SetTransObject(sqlca)
	
	ldwc_planta.Retrieve(1)
//	ldwc_ptodes.Retrieve(0)
//	ldwc_ptoori.Retrieve(900)
//	ldwc_plades.Retrieve(li_Cliente)
End If

If ii_tipo	=	1 Then
	If validadespacho(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),Long(em_nroguia.Text)) Then Return
	If cbx_6.Checked Then li_vari = -9
	If cbx_7.Checked Then li_emba = -9
	If cbx_8.Checked Then li_calib = -9
	If cbx_9.Checked Then li_control = 1
		
	 If cbx_valores.Checked Then  		
		If ii_tipo = 1 Then
			vinf.dw_1.DataObject	= "dw_info_guiadespacho_validadatos"
			vinf.dw_1.SetTransObject(sqlca)
					
			fila = vinf.dw_1.Retrieve(li_cliente, li_planta, ll_nroguia,Integer(istr_mant.argumento[25]),ii_var, ii_prod, ii_cal,li_vari,li_emba,li_calib,li_control)
			
			If fila = -1 Then
				MessageBox( "Error en Base de Datos", "Se ha producido un error en Base de datos : ~n" + sqlca.SQLErrText, StopSign!, Ok!)
			ElseIf fila = 0 Then				
				MessageBox("Atención","Valores de Embarques Correctos.")
				Return
			ElseIf fila > 0 Then
				F_Membrete(vinf.dw_1)
				If gs_Ambiente <> 'Windows' Then F_ImprimeInformePdf(vinf.dw_1, istr_info.titulo)
				MessageBox("Atención","Faltan Datos en Tabla EmbarValores.")
				Return				
			End If					 
		End If	
	End If	
	
	If ii_tipo = 1 Then
		If li_cliente <> 590  Then
			If IsNull(ls_FtoGuiaDespa) OR ls_FtoGuiaDespa = '' Then
				vinf.dw_1.DataObject = is_report
			Else
				vinf.dw_1.DataObject	= ls_FtoGuiaDespa
				dw_guia.DataObject	= ls_FtoGuiaDespa		
			End If
		Else	
			If ls_FtoGuiaDespa = '' Then
				vinf.dw_1.DataObject = 'dw_info_guia_despacho_lirios'
				dw_guia.DataObject   = 'dw_info_guia_despacho_lirios'
			Else
				vinf.dw_1.DataObject	= ls_FtoGuiaDespa
				dw_guia.DataObject	= ls_FtoGuiaDespa		
			End If
		End If
	ElseIf cbx_sdp.Checked Then
		vinf.dw_1.DataObject = 'dw_info_anexo_guia_despacho_sdp'
	Else
		vinf.dw_1.DataObject = is_report
	End If	

	vinf.dw_1.SetTransObject(sqlca)
	fila = vinf.dw_1.Retrieve(li_cliente, li_planta, ll_nroguia,Integer(istr_mant.argumento[25]),ii_var, ii_prod, ii_cal,li_vari,li_emba,li_calib,li_control)
	fila = dw_guia.Retrieve(li_cliente, li_planta, ll_nroguia,Integer(istr_mant.argumento[25]),ii_var, ii_prod, ii_cal,li_vari,li_emba,li_calib,li_control)
	ls_DirectorioAct=GetCurrentDirectory()
	ls_Archivo	=	ls_DirectorioAct + '\Guía Nº'+String(ll_nroguia)+' '+String(today(),'yyyymmdd')+'.pdf'
	is_asunto = String(ll_nroguia)
	is_archivo = ls_Archivo
	dw_guia.SaveAs(ls_Archivo, PDF!  , True)

	If cbx_9.Checked Then
		vinf.dw_1.Modify("DataWindow.Summary.Height.AutoSize")
	Else	
		vinf.dw_1.Modify("DataWindow.Summary.Height = 72")
	End If	
	 
	/*
  	Estado de impresion de guia
  	*/
  UPDATE dbo.despafrigoguias SET
    degd_estado = 1
    WHERE clie_codigo = :li_cliente
    AND plde_codigo   = :li_planta
    AND defe_numero   = :il_despacho
	 AND defe_guides   = :ll_nroguia;
	 COMMIT;
	
	enviamail()
ElseIf ii_tipo	=	2 Then
	If cbx_valores.Checked Then
		vinf.dw_1.DataObject	= "dw_info_guiadespacho_validadatos"
		vinf.dw_1.SetTransObject(sqlca)
				
		fila = vinf.dw_1.Retrieve(li_cliente, li_planta, ll_nroguia,Integer(istr_mant.argumento[25]),ii_var, ii_prod, ii_cal,li_vari,li_emba,li_calib,li_control)
		
		If fila = -1 Then
			MessageBox( "Error en Base de Datos", "Se ha producido un error en Base " + &
							"de datos : ~n" + sqlca.SQLErrText, StopSign!, Ok!)
		ElseIf fila = 0 Then				
			MessageBox("Atención","Valores de Embarques Correctos.")
			Return
		ElseIf fila > 0 Then
			F_Membrete(vinf.dw_1)
			If gs_Ambiente <> 'Windows' Then F_ImprimeInformePdf(vinf.dw_1, istr_info.titulo)
			MessageBox("Atención","Faltan Datos en Tabla EmbarValores.")
			Return			
		End If
	End If		
	
	If cbx_sdp.Checked Then
		vinf.dw_1.DataObject = 'dw_info_anexo_guia_despacho_sdp'
	Else
		vinf.dw_1.DataObject = is_report
	End If	
	vinf.dw_1.SetTransObject(sqlca)
   	fila = vinf.dw_1.Retrieve(li_cliente, li_planta, ll_nroguia, ii_var, ii_prod, ii_cal)
ElseIf ii_tipo	=	3 Then
	dw_5.reset()
	dw_5.SetTransObject(SQLCA)
	
	ll_guia 			=  Long(em_nroguia.Text)
	ls_Instructivo	=	is_embarque
	ls_embarque	=	is_embarque
	ll_planilla			=	al_planilla
		
	ll_filcont		=  dw_5.Retrieve(Integer(istr_mant.argumento[1]),Integer(istr_mant.argumento[2]),&
											ll_planilla,ii_var,ii_cal,ii_prod,ll_guia, 0, '-1',ls_Instructivo)
	If ll_filcont > 0 Then
		If valida_datos() Then
			Return
		End If	
	End If	
	
	dw_tipopallet.SetTransObject(sqlca)
	dw_etiqueta.SetTransObject(sqlca)
	
	If cbx_csg.Checked Then
		vinf.dw_1.DataObject = 'dw_info_anexo_guia_despacho_csg'
//	ElseIf cbx_sdp.Checked Then
//		vinf.dw_1.DataObject = 'dw_info_anexo_guia_despacho_sdp'
	Else		
		vinf.dw_1.DataObject = is_report
	End If

	vinf.dw_1.SetTransObject(sqlca)
	
	If cbx_frio.Checked Then li_frio = 1	
	If cbx_id.Checked Then li_marca = 0	
	ll_filpallet = dw_tipopallet.Retrieve(li_cliente, li_planta, ll_nroguia,0, ii_var, ii_prod, ii_cal,ii_cli,ii_pakrot,li_frio,li_marca,ls_tipoIns)
	ls_texto = ''
	
	If ll_filpallet > 1 Then
		For ll_fila = 1 TO ll_filpallet
			If ls_texto = '' Then
				ls_texto = String(dw_tipopallet.Object.copa_codigo[ll_fila])
			Else
				ls_texto = ls_texto+' - '+ String(dw_tipopallet.Object.copa_codigo[ll_fila])
			End If	
		Next
		MessageBox("Atención","Existe más de un código de pallet en despacho ("+ls_texto+").")
	End If	
	
	ll_filetiqueta = dw_etiqueta.Retrieve(li_cliente, li_planta, ll_nroguia,0, ii_var, ii_prod, ii_cal,ii_cli,ii_pakrot,li_frio,li_marca,ls_tipoIns)
	
	If ll_filetiqueta > 1 Then
		ls_texto = ''
		For ll_fila = 1 TO ll_filetiqueta
			If ls_texto = '' Then
				ls_texto = String(dw_etiqueta.Object.etiq_codigo[ll_fila])
			Else
				ls_texto = ls_texto+' - '+ String(dw_etiqueta.Object.etiq_codigo[ll_fila])
			End If	
		Next	
		MessageBox("Atención","Existe más de un código de Etiqueta en despacho ("+ls_texto+").")
	End If
	
   fila = vinf.dw_1.Retrieve(li_cliente, li_planta, ll_nroguia,0, ii_var, ii_prod, ii_cal,ii_cli,ii_pakrot,li_frio,li_marca,ls_tipoIns)
	vinf.dw_1.Modify('DataWindow.Zoom = 95')

	If cbx_archivo.Checked Then
		ls_Archivo	=	"\Guia Despacho-"+String(ll_nroguia)+".xls"
		ids_archivo.DataObject	=	'dw_info_anexo_resumen_guia_despacho'
		ids_archivo.SetTransObject(sqlca)
		ids_archivo.Retrieve(li_cliente,li_planta,ll_nroguia)

		RegistryGet( "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders", "Personal", RegString!, ls_Ruta)
				
		ids_archivo.SaveAs(ls_Ruta + ls_Archivo,excel5!, True)
		MessageBox("Atención","Archivo Formato Excel, Generado.")
	End If
End If

If fila = -1 Then
	MessageBox( "Error en Base de Datos", "Se ha producido un error en Base de datos : ~n" + sqlca.SQLErrText, StopSign!, Ok!)
ElseIf fila = 0 Then
	MessageBox( "No Existe información", "No existe información para este informe.", StopSign!, Ok!)
 Else
	F_Membrete(vinf.dw_1)
	Despacho(li_cliente, li_planta, ll_nroguia)
	
	If ii_tipo	=	1 Then
		ls_parteemb = Right(is_embarque, 1)
		is_parteemb = Right(is_embarque, 1)
		//If Upper(ls_parteemb) <> Upper('M')   Then generaarchivo()
		If ii_controlstembex = 0 Then generaarchivostembex()		
	End If	
	
	If ii_tipo	=	1 OR ii_tipo	=	3 Then
		If li_tipoembq = 7 OR li_tipoembq = 8 OR li_tipoembq = 9 Then
			For ll_Fila	=  1 TO fila
				vinf.dw_1.SetItem(ll_Fila, "embc_nombre", em_recibidor.text)
				vinf.dw_1.SetItem(ll_Fila, "embc_nrorut", em_rut.text)
				vinf.dw_1.SetItem(ll_Fila, "embc_direcc", em_direccion.text)
				vinf.dw_1.SetItem(ll_Fila, "embc_ciudad", em_ciudad.Text)
			Next
		End If
		
		If li_tipoembq = 11 Then
			For ll_Fila	=  1 To fila
				If em_recibidor.text <> '' Then vinf.dw_1.SetItem(ll_Fila, "embc_nombre", em_recibidor.text)
				If em_rut.text <> '' Then vinf.dw_1.SetItem(ll_Fila, "embc_nrorut", em_rut.text)
				If em_direccion.text <> '' Then vinf.dw_1.SetItem(ll_Fila, "embc_direcc", em_direccion.text)
				If em_ciudad.Text <> '' Then vinf.dw_1.SetItem(ll_Fila, "embc_ciudad", em_ciudad.Text)
			Next
		End If
	End If
	
	If ii_tipo	=	2 Then
		vinf.dw_1.Modify("cliente.text = '" + em_exportador.Text + "'")
		vinf.dw_1.Modify("planta.text = '" + ls_planta + "'")
		vinf.dw_1.Modify("guia.text = '" + em_nroguia.Text + "'")
		vinf.dw_1.SaveAs("C:\GeneradosSaam\"+'ID'+String(li_cliente)+''+String(li_planta)+''+String(ll_nroguia)+'.PDF', PDF!, TRUE)
	End If
	
	If ii_tipo	=	3 Then
		vinf.dw_1.Modify("t_nomdespachador.text = '" + em_nomdespachador.text + "'")	
		vinf.dw_1.Modify("t_nominspector.text = '" + em_nominspector.text + "'")			
		vinf.dw_1.Modify("cliente.text = '" + em_exportador.Text + "'")
		vinf.dw_1.Modify("t_puerto.text = '" + em_puerto.Text + "'")
		vinf.dw_1.Modify("t_destino.text = '" + em_destino.Text + "'")
		vinf.dw_1.SaveAs("C:\GeneradosSaam\"+'AD' +String(li_cliente)+''+String(li_planta)+''+String(ll_nroguia)+'.PDF', PDF!, TRUE)
	End If
	
	If ii_tipo	=	1 Then
		vinf.dw_1.Modify("t_guia.text = '" + em_nroguia.Text + "'")
		vinf.dw_1.SaveAs("C:\GeneradosSaam\"+'GD' +String(li_cliente)+''+String(li_planta)+''+String(ll_nroguia)+'.PDF', PDF!, TRUE)
		vinf.dw_1.Modify("t_puerto.text = '" + em_puerto.Text + "'")		
		If li_planta = 81 Then vinf.dw_1.Modify("t_glosa.text = '" + em_glosaespecial.Text + "'")
		
		If li_cliente = 590 Then
			vinf.dw_1.Modify("t_tipomv.text = '" + em_tipomv.Text + "'")
			vinf.dw_1.Modify("t_nomrespon.text = '" + em_nomdespachador.Text + "'")
			vinf.dw_1.Modify("t_puerto.text = '" + em_puerto.Text + "'")
			vinf.dw_1.Modify("t_destino.text = '" + em_destino.Text + "'")
		End If	
	End If
	
	vinf.dw_1.Modify("t_observa.text = '" + em_observa.text + "'")	
	vinf.dw_1.Modify("t_cansellos.text = '" + em_cansellos.text + "'")
	vinf.dw_1.Modify("t_ubisellos.text = '" + em_ubisellos.text + "'")
	vinf.dw_1.Modify("t_numsellos.text = '" + em_numsellos.text + "'")	
	If gs_Ambiente <> 'Windows' Then F_ImprimeInformePdf(vinf.dw_1, istr_info.titulo)
	vinf.dw_1.GroupCalc()
End If

SetPointer(Arrow!)				
end event

type pb_salir from w_para_informes`pb_salir within w_info_guia_despacho
integer x = 2505
integer y = 2104
integer taborder = 260
end type

type st_1 from statictext within w_info_guia_despacho
integer x = 274
integer y = 476
integer width = 462
integer height = 76
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Planta"
boolean focusrectangle = false
end type

type st_2 from statictext within w_info_guia_despacho
integer x = 274
integer y = 580
integer width = 325
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Nro. Guia"
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

type dw_2 from datawindow within w_info_guia_despacho
integer x = 910
integer y = 380
integer width = 1230
integer height = 96
integer taborder = 10
boolean bringtotop = true
string dataobject = "dddw_clientesprod"
boolean border = false
boolean livescroll = true
end type

event itemchanged;istr_mant.argumento[1]	=	String(data)
idwc_planta.Retrieve(1)
istr_mant.argumento[2]	=	String(dw_1.Object.plde_codigo[1])
dw_1.SetItem(1, "plde_codigo", Integer(istr_mant.argumento[2]))

IF data <> '81' THEN
	em_glosaespecial.Enabled = False
ELSE	
	em_glosaespecial.Enabled = True
END IF	
end event

type st_6 from statictext within w_info_guia_despacho
integer x = 274
integer y = 388
integer width = 233
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Cliente"
boolean focusrectangle = false
end type

type dw_1 from datawindow within w_info_guia_despacho
integer x = 914
integer y = 472
integer width = 965
integer height = 96
integer taborder = 20
boolean bringtotop = true
string title = "none"
string dataobject = "dddw_plantadesp_tipo"
boolean border = false
boolean livescroll = true
end type

event itemchanged;Long li_Null

SetNull(li_Null)

If iuo_Plantas.Existe(Long(Data), True, Sqlca) Then
	istr_mant.argumento[2]=String(iuo_Plantas.Codigo)
Else
	This.SetItem(1,"plde_codigo", li_Null)
	Return 1
End If
end event

event itemerror;Return 1
end event

type em_nroguia from editmask within w_info_guia_despacho
integer x = 919
integer y = 564
integer width = 402
integer height = 96
integer taborder = 30
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 16777215
string text = "none"
alignment alignment = center!
borderstyle borderstyle = stylelowered!
string mask = "########"
end type

event modified;IF ExisteGuia(Long(This.Text)) = False THEN
	This.SetFocus()
END IF
end event

type gb_3 from groupbox within w_info_guia_despacho
integer x = 288
integer y = 712
integer width = 768
integer height = 192
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
end type

type cbx_1 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 2953
integer y = 956
integer width = 695
integer height = 80
integer taborder = 60
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Variedad Rotulada"
boolean checked = true
end type

event clicked;IF This.Checked THEN
	ii_var =	1	
ELSE
	ii_var =	0
END IF

end event

type cbx_2 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 2944
integer y = 1184
integer width = 695
integer height = 80
integer taborder = 70
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Productor Rotulado"
boolean checked = true
end type

event clicked;IF This.Checked THEN
	ii_prod =	1	
ELSE
	ii_prod =	0
END IF
end event

type cbx_3 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 2939
integer y = 860
integer width = 695
integer height = 80
integer taborder = 80
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Calidad Rotulada"
end type

event clicked;IF This.Checked THEN
	ii_cal =	1	
ELSE
	ii_cal =	0
END IF
end event

type cbx_4 from checkbox within w_info_guia_despacho
integer x = 347
integer y = 784
integer width = 695
integer height = 80
integer taborder = 90
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Cliente Rotulado"
end type

event clicked;IF This.Checked THEN
	ii_cli =	1	
ELSE
	ii_cli =	0
END IF

end event

type st_3 from statictext within w_info_guia_despacho
integer x = 251
integer y = 1064
integer width = 2107
integer height = 1228
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 16711680
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

type st_5 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1088
integer width = 498
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Despachadado a"
boolean focusrectangle = false
end type

type st_7 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1180
integer width = 402
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Rut"
boolean focusrectangle = false
end type

type st_8 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1272
integer width = 402
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Dirección"
boolean focusrectangle = false
end type

type em_recibidor from editmask within w_info_guia_despacho
integer x = 919
integer y = 1072
integer width = 1358
integer height = 88
integer taborder = 140
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
end type

type em_rut from editmask within w_info_guia_despacho
integer x = 919
integer y = 1164
integer width = 480
integer height = 88
integer taborder = 150
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
alignment alignment = center!
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string mask = "###.###.###-a"
end type

type em_direccion from editmask within w_info_guia_despacho
integer x = 919
integer y = 1256
integer width = 1358
integer height = 88
integer taborder = 160
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
end type

type cbx_5 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 2939
integer y = 1308
integer width = 695
integer height = 80
integer taborder = 100
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Packing Rotulado"
end type

event clicked;IF This.Checked THEN
	ii_pakrot =	1	
ELSE
	ii_pakrot =	0
END IF

end event

type st_9 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1368
integer width = 581
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Observaciones G.D."
boolean focusrectangle = false
end type

type em_observa from editmask within w_info_guia_despacho
integer x = 919
integer y = 1348
integer width = 1358
integer height = 88
integer taborder = 170
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string minmax = "~~200"
end type

type dw_guia from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 2816
integer y = 236
integer width = 197
integer height = 152
boolean bringtotop = true
string title = "none"
end type

type cbx_6 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 3026
integer y = 1472
integer width = 402
integer height = 80
integer taborder = 110
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Variedad"
end type

type cbx_7 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 2935
integer y = 1068
integer width = 402
integer height = 80
integer taborder = 120
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Embalaje"
end type

type cbx_8 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 3022
integer y = 1724
integer width = 402
integer height = 80
integer taborder = 130
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Calibre"
end type

type st_13 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1456
integer width = 658
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Nombre Responsable"
boolean focusrectangle = false
end type

type em_nomdespachador from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 1440
integer width = 1358
integer height = 88
integer taborder = 180
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type st_10 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1544
integer width = 658
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Tipo Movto."
boolean focusrectangle = false
end type

type em_tipomv from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 1532
integer width = 1358
integer height = 88
integer taborder = 190
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
string text = "EXPORTACION"
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type em_puerto from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 1624
integer width = 1358
integer height = 88
integer taborder = 200
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
boolean enabled = false
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type em_destino from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 1716
integer width = 1358
integer height = 88
integer taborder = 210
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
boolean enabled = false
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type st_11 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1632
integer width = 622
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Puerto"
boolean focusrectangle = false
end type

type st_12 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1720
integer width = 622
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "País Destino"
boolean focusrectangle = false
end type

type st_14 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1824
integer width = 521
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Inspector SAG"
boolean focusrectangle = false
end type

type em_nominspector from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 1808
integer width = 1358
integer height = 88
integer taborder = 220
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type gb_frio from groupbox within w_info_guia_despacho
boolean visible = false
integer x = 1243
integer y = 712
integer width = 768
integer height = 192
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Consolida"
end type

type cbx_frio from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 1266
integer y = 784
integer width = 402
integer height = 80
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Tipo Frío"
end type

type gb_4 from groupbox within w_info_guia_despacho
boolean visible = false
integer x = 2962
integer y = 1424
integer width = 768
integer height = 416
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 553648127
string text = "Consolida"
end type

type st_4 from statictext within w_info_guia_despacho
integer x = 251
integer y = 372
integer width = 2107
integer height = 688
integer textsize = -10
integer weight = 700
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 16711680
boolean enabled = false
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

type cbx_id from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 1531
integer y = 560
integer width = 151
integer height = 80
integer taborder = 50
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "ID"
end type

type em_glosaespecial from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 1900
integer width = 1358
integer height = 88
integer taborder = 230
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
boolean enabled = false
string text = "Traslado de Mercadería desde Frigorífico las delicias ubicado en Camino La Compañía s/n Callejón Las Delicias Codegua de COMERCIAL RIO BLANCO LAS DELICIAS SEGÚN CONTRATO PRESTACIÓN DE SERVICIOS a Interior Recintos Portuarios."
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type st_15 from statictext within w_info_guia_despacho
integer x = 274
integer y = 1912
integer width = 521
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Glosa Especial"
boolean focusrectangle = false
end type

type cbx_sdp from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 1330
integer y = 560
integer width = 206
integer height = 80
integer taborder = 40
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "SDP"
end type

event clicked;//IF cbx_sdp.Checked THEN
//	cbx_csg.Checked = False
//END IF	
end event

type mle_condicion from multilineedit within w_info_guia_despacho
integer x = 919
integer y = 1992
integer width = 736
integer height = 88
integer taborder = 240
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
string text = "FRESCO"
integer limit = 20
borderstyle borderstyle = stylelowered!
end type

type st_22 from statictext within w_info_guia_despacho
integer x = 274
integer y = 2000
integer width = 585
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Condición"
boolean focusrectangle = false
end type

type st_16 from statictext within w_info_guia_despacho
integer x = 251
integer y = 2292
integer width = 2107
integer height = 96
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 16711680
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

type cbx_archivo from checkbox within w_info_guia_despacho
integer x = 279
integer y = 2300
integer width = 2057
integer height = 80
integer taborder = 50
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Archivo Resumen de los Predios, Provincias, Comunas y Cuarteles"
end type

type cbx_9 from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 1678
integer y = 560
integer width = 658
integer height = 80
integer taborder = 50
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Resumen de Pallet"
end type

type st_17 from statictext within w_info_guia_despacho
integer x = 274
integer y = 2096
integer width = 658
integer height = 76
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Números de Sellos"
boolean focusrectangle = false
end type

type em_numsellos from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 2092
integer width = 1358
integer height = 84
integer taborder = 130
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type st_18 from statictext within w_info_guia_despacho
integer x = 270
integer y = 2192
integer width = 635
integer height = 84
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "Cantidad - Ubicación "
boolean focusrectangle = false
end type

type em_ubisellos from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 1083
integer y = 2184
integer width = 1193
integer height = 84
integer taborder = 140
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type dw_3 from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 3022
integer y = 236
integer width = 197
integer height = 152
integer taborder = 150
boolean bringtotop = true
string title = "none"
string dataobject = "dw_ubicacionessellossag"
end type

type em_cansellos from editmask within w_info_guia_despacho
event getfocus pbm_ensetfocus
integer x = 919
integer y = 2184
integer width = 160
integer height = 84
integer taborder = 140
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 16777215
alignment alignment = center!
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string displaydata = "$"
end type

type cbx_valores from checkbox within w_info_guia_despacho
integer x = 457
integer y = 2308
integer width = 965
integer height = 68
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Revisa Valores de Embarque"
end type

type st_19 from statictext within w_info_guia_despacho
integer x = 1422
integer y = 1180
integer width = 256
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Ciudad"
boolean focusrectangle = false
end type

type em_ciudad from editmask within w_info_guia_despacho
integer x = 1705
integer y = 1164
integer width = 571
integer height = 88
integer taborder = 180
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string minmax = "~~200"
end type

type cbx_csg from checkbox within w_info_guia_despacho
boolean visible = false
integer x = 1330
integer y = 632
integer width = 402
integer height = 80
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
boolean enabled = false
string text = "CSG / SDP"
boolean checked = true
end type

event clicked;//IF cbx_csg.Checked THEN
//	cbx_sdp.Checked = False
//END IF
end event

type dw_4 from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 3227
integer y = 236
integer width = 197
integer height = 152
integer taborder = 150
boolean bringtotop = true
string title = "none"
string dataobject = "dw_gene_archivo_saam_estado_nuevo_guia"
end type

type dw_5 from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 3227
integer y = 396
integer width = 197
integer height = 152
integer taborder = 70
boolean bringtotop = true
string title = "none"
string dataobject = "dw_controla_prediocuartel_guia"
end type

type dw_6 from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 3227
integer y = 76
integer width = 197
integer height = 152
integer taborder = 30
boolean bringtotop = true
string title = "none"
string dataobject = "dw_info_archivo_saam_packing_nuevo"
end type

type dw_7 from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 2816
integer y = 76
integer width = 197
integer height = 152
integer taborder = 10
boolean bringtotop = true
string title = "none"
string dataobject = "dw_gene_archivo_saam_plano_nuevo"
end type

type dw_8 from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 3022
integer y = 76
integer width = 197
integer height = 152
integer taborder = 180
boolean bringtotop = true
string title = "none"
string dataobject = "dw_palleteliminados_despacho"
end type

type dw_tipopallet from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 2816
integer y = 396
integer width = 197
integer height = 152
integer taborder = 100
boolean bringtotop = true
string title = "none"
string dataobject = "dw_validatipopallet"
end type

type dw_etiqueta from datawindow within w_info_guia_despacho
boolean visible = false
integer x = 3022
integer y = 396
integer width = 197
integer height = 152
integer taborder = 180
boolean bringtotop = true
string title = "none"
string dataobject = "dw_validaetiqueta"
end type

type st_20 from statictext within w_info_guia_despacho
integer x = 274
integer y = 948
integer width = 498
integer height = 64
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 553648127
string text = "Exportado"
boolean focusrectangle = false
end type

type em_exportador from editmask within w_info_guia_despacho
integer x = 1175
integer y = 932
integer width = 1102
integer height = 88
integer taborder = 150
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
end type

type em_rutexpo from editmask within w_info_guia_despacho
integer x = 631
integer y = 932
integer width = 544
integer height = 88
integer taborder = 160
boolean bringtotop = true
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
borderstyle borderstyle = stylelowered!
maskdatatype maskdatatype = stringmask!
string mask = "aaa.aaa.aaa-a"
end type

